<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>

    <title>INFO4310 Final Project</title>

    <style>
        body {
            font-family: monaco, Consolas, Lucida Console, monospace;
            background: #f9f9f9;
        }

        .sectionTitles {
            font-size: 60px;
            text-align: center;
        }

        .websiteTitle {
            font-size: 80px;
            text-align: center;
            color: #2e2e2e;
        }

        .authorsTitle {
            font-size: 30px;
            font-style: italic;
            text-align: center;
            color: #2e2e2e;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 1000px;
        }

        .olympicsflexcontainermain {
            height: 750px;
        }

        .olympicsflexcontainertoc {
            margin: auto;
            margin-top: -575px;
            width: 990px;
        }

        .olympicsflexcontainer1,
        .olympicsflexcontainer2 {
            display: flex;
            flex-direction: row;
        }

        .toc_textbox_r1 {
            height: 240px;
            width: 240px;
            border-radius: 50%;
            text-align: center;
            margin: 45px;
            display: flex;
        }

        .olympicsflexcontainer2 {
            margin-left: 165px;
            margin-top: -180px;
        }

        .toc_textbox_r2 {
            height: 240px;
            width: 240px;
            border-radius: 50%;
            text-align: center;
            margin: 45px;
            display: flex;
        }

        .toc_text {
            text-decoration: none;
            color: #2e2e2e;
            font-weight: bold;
            font-size: 15px;
            margin: auto;
            width: 200px;
        }

        hr.solid {
            border-top: 3px solid #2e2e2e;
        }

        #mapPanel {
            color: #2e2e2e;
        }

        #scatterplotPanel {
            background: #14284a;
            position: absolute;
            left: 0;
            right: 0;
            color: white;
        }

        #flexContainerSP_1 {
            display: flex;
            justify-content: center;
            width: 890px;
            height: 275px;
            margin: 30px auto;
            border: 1.5px solid lightgray;
            background: rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        #flexContainerSP_1 h3,
        #generateButtonSP,
        #resetButtonSP,#errorTextSP {
            font-size: 15px;
        }

        .filterButtonSPflexContainer {
            display: flex;
            flex-direction: row;
        }

        .filterTitlesSP {
            font-size: 13px;
        }

        #reqSPFilters {
            width: 250px;
            padding: 10px;
            padding-left: 30px;
            text-align: left;
        }

        #selectSportSP,
        #selectNationalitySP,
        #selectEventSP {
            width: 175px;
            height: 20px;
        }

        .checkboxMedalsFlexContainer{
          display: flex;
          flex-direction: row;
          margin-top: -2px;
          margin-left: -2px;
        }

        /* .checkboxMedalsFlexContainer label {
          margin-left: 5px;
          margin-right: 15px;
          margin-top: 2px;
        } */

        #optSPFilters {
            width: 600px;
            padding: 10px;
            padding-left: 30px;
            text-align: left;
            border-left: 1.5px solid lightgray;
        }

        .radioGenderSPflexcontainer,
        .radioSeasonSPflexcontainer {
            display: flex;
            flex-direction: row;
            height: 17px;
        }

        .radioGenderSPflexcontainer label,
        .radioSeasonSPflexcontainer label {
            margin-left: 5px;
            margin-right: 15px;
            margin-top: 2px;
        }

        /* Styling for Scatterplot radio button filters */
        .radioSPStyling{
          display: block;
          position: relative;
          padding-left: 25px;
          margin-bottom: 12px;
          cursor: pointer;
          font-size: 13px;
          font-family: monaco, Consolas, Lucida Console, monospace;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
        }

        .radioSPStyling input {
          margin-left: 10px;
          opacity: 0;
          cursor: pointer;
          height: 0;
          width: 0;
        }

        .radioSPStyling:hover input ~ .radioDot {
          background-color: #d9f1ff;
        }

        .radioSPStyling input:checked ~ .radioDot {
          background-color: #2081c7;
        }

        .radioDot {
          position: absolute;
          top: 0;
          left: 0;
          height: 20px;
          width: 20px;
          margin-top: -2px;
          margin-left: -3px;
          background-color: #a3d9f7;
          border-radius: 50%;
        }

        .radioDot:after {
          content: "";
          position: absolute;
          display: none;
        }

        .radioSPStyling input:checked ~ .radioDot:after {
          display: block;
        }

        .radioSPStyling .radioDot:after {
          top: 6px;
          left: 6px;
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: white;
        }
        /* Styling for Scatterplot checkbox filters */
        .checkboxSPStyling{
          display: block;
          position: relative;
          padding-left: 25px;
          margin-bottom: 12px;
          cursor: pointer;
          font-size: 13px;
          font-family: monaco, Consolas, Lucida Console, monospace;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
        }

        .checkboxSPStyling input {
          margin-left: 10px;
          opacity: 0;
          cursor: pointer;
          height: 0;
          width: 0;
        }

        .checkboxSPStyling:hover input ~ .checkmark {
          background-color: #d9f1ff;
        }

        .checkboxSPStyling input:checked ~ .checkmark {
          background-color: #2081c7;
        }

        .checkmark {
          position: absolute;
          top: 0;
          left: 0;
          height: 15px;
          width: 15px;
          background-color: #a3d9f7;
        }

        .checkmark:after {
          content: "";
          position: absolute;
          display: none;
        }

        .checkboxSPStyling input:checked ~ .checkmark:after {
          display: block;
        }

        .checkboxSPStyling .checkmark:after {
          left: 4px;
          top: 0px;
          width: 5px;
          height: 10px;
          border: solid white;
          border-width: 0 3px 3px 0;
          -webkit-transform: rotate(45deg);
          -ms-transform: rotate(45deg);
          transform: rotate(45deg);
        }
        /* Styling for Scatterplot dropdown filters */
        #selectSportSP, #selectNationalitySP, #selectEventSP {
          font-family: monaco, Consolas, Lucida Console, monospace;
          stroke: none;
          background-color: #2081c7;
          color: white;
          border:0px;
          outline:0px;
          border-radius: 5px;
          padding: 0 1em;
        }

        .reqSPFilters_flexContainer label{
          font-size: 13px;
        }

        .reqSPFilters_flexContainer {
            display: flex;
            flex-direction: column;
            margin-top: -15px;
        }

        .optSPFilters_flexContainer {
            display: flex;
            flex-direction: row;
            margin-top: -15px;
        }

        .optSPFilters_flex_section1 {
            width: 200px;
        }

        .optSPFilters_flex_section2, .optSPFilters_flex_section3{
            width: 200px;
        }

        .optSPFilters_flexContainer select, .reqSPFilters_flexContainer select{
          margin-top: -5px;
        }

        .optSPSilderContainers{
          height: 90px;;
        }

        .sliderRange{
          margin-left: -10px;
          margin-top: -25px;
        }

        .sliderRange text{
          fill: white;
          font-size: 12px;
          font-family: monaco, Consolas, Lucida Console, monospace;
        }

        .generateButtonSP,
        .resetButtonSP, #errorTextSP {
            text-align: center;
            margin: auto;
        }

        #errorTextSP {
          font-style: italic;
          font-weight: bold;
          color: #af2323;
          width: 400px;
          opacity: 0%;
        }

        #generateButtonSP,
        #resetButtonSP {
            font-family: monaco, Consolas, Lucida Console, monospace;
            font-weight: bold;
            background-color: #f9f9f9;
            border: 1.5px solid lightgray;
            padding: 5px;
            padding-left: 20px;
            padding-right: 20px;
        }

        #flexContainerSP_2 {
            display: flex;
            justify-content: center;
        }

        #graphSP,
        #profilePanelSP {
            margin-top: 30px;
            margin-bottom: 30px;
            margin-right: 30px;
            height: 700px;
        }

        #graphSP, #legendSP{
          width: 800px;
        }

        #profilePanelSP{
          width: 600px;
          padding-bottom: 20px;
        }

        #profilePanelSPflexContainer{
          display: flex;
          flex-direction: row;
        }

        #profilePanelSPIntroStatsContainer{
          height: 250px;
          width: 300px;
          padding-top: 20px;
          padding-left: 20px;
        }

        #profilePanelSPIntroStats p{
          margin: 0;
          font-size: 15px;
          padding-bottom: 5px;
        }

        #profilePanelSPIntro h4{
          margin: 0;
          font-size: 18px;
          font-weight: bold;
          padding-bottom: 5px;
        }

        #profilePanelSPIntro{
          padding-bottom: 20px;
        }

        #profilePanelSPPhysicalTraits{
          height: 250px;
          width: 300px;
        }

        #profilePanelSPTraitsText{
          text-align: center;
          width: 140px;
          padding-left: 160px;
        }

        #profilePanelSPTraitsIcon{
          text-align: right;
          padding-right: 30px;
        }

        #profilePanelSPTraitsText h4, #profilePanelSPTraitsText p{
          font-size: 13px;
          margin: 0;
        }

        /* #scatterlegendsvg {
            background-color: rgba(255, 255, 255, 0.1);
        } */

        .y.axis text, .x.axis text {
          font-size: 13px;
        }

        /* #profilePanelSPSVG {
            padding-left: 20px;
        } */

        #savedAthletesTablePanel {
            margin-top: 100px;
            padding: 20px;
            height: 800px;
        }

        #savedAthletesTable {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1.5px solid lightgray;
            width: 1400px;
            margin: auto;
        }

        #viz {
            height: 130vh;
        }

        .boundary {
            fill: #DEB887;
            stroke: black;
            stroke-width: 1px;
        }

        #flexContainerMP_1 {
            display: flex;
            justify-content: center;
        }

        #map_svg {
            border: 2px solid rgb(230, 238, 247);
            background-color: rgb(230, 238, 247);
        }

        #timeline {
            text-align: center;
            position: relative;
            /* top: 600px; */
        }
    </style>
</head>

<body>
    <div id='p1'>
        <!-- ********************************** -->
        <!--   SCATTERPLOT VISUALIZATION        -->
        <!-- ********************************** -->
        <div id="scatterplotPanel">
            <h1 class="sectionTitles">Athlete Profiles</h1>
            <!-- Section 1: Scatterplot Filters Panel -->
            <div id="flexContainerSP_1">
                <!-- Required Filters -->
                <div id="reqSPFilters">
                    <h3><b>Required Filters:</b></h3>
                    <div class="reqSPFilters_flexContainer">
                        <div class="radioSeasonSP">
                            <h4 class="filterTitlesSP">Season</h4>
                            <div class="radioSeasonSPflexcontainer">
                              <label class = "radioSPStyling" for="summerSP">Summer
                                <input type="radio" id="summerSP" name="seasonSP" value="Summer">
                                <span class="radioDot"></span>
                              </label><br>
                              <label class = "radioSPStyling" for="winterSP">Winter
                                <input type="radio" id="winterSP" name="seasonSP" value="Winter">
                                <span class="radioDot"></span>
                              </label><br>
                            </div>
                        </div>
                        <div class="selectSportSP">
                            <h4 class="filterTitlesSP">Sport</h4>
                            <select name="selectSportSP" id="selectSportSP">
                              <option selected="selected">Select Sport</option>
                            </select>
                        </div>
                        <div class="radioGenderSP">
                            <h4 class="filterTitlesSP">Gender</h4>
                            <div class="radioGenderSPflexcontainer">
                              <label class = "radioSPStyling" for="maleSP">Male
                                <input type="radio" id="maleSP" name="genderSP" value="M">
                                <span class="radioDot"></span>
                              </label><br>
                              <label class = "radioSPStyling" for="femaleSP">Female
                                <input type="radio" id="femaleSP" name="genderSP" value="F">
                                <span class="radioDot"></span>
                              </label><br>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Optional Filters -->
                <div id="optSPFilters">
                    <h3><b>Optional Filters:</b></h3>
                    <div class="optSPFilters_flexContainer">
                        <div class="optSPFilters_flex_section1">
                            <h4 class="filterTitlesSP">Nationality</h4>
                            <select id="selectNationalitySP"></select>
                            <h4 class="filterTitlesSP">Event</h4>
                            <select id="selectEventSP"></select>
                            <h4 class="filterTitlesSP"># of Medals</h4>
                            <div class = "checkboxMedalsFlexContainer">
                                <label class = "checkboxSPStyling" for="medalsOne">1+
                                  <input type="checkbox" id="medalsOne" name="medalsOne" value="1" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                                <label class = "checkboxSPStyling" for="medalsTwo">2+
                                  <input type="checkbox" id="medalsTwo" name="medalsTwo" value="2" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                                <label class = "checkboxSPStyling" for="medalsThree">3+
                                  <input type="checkbox" id="medalsThree" name="medalsThree" value="3" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                              <!-- <select id="selectTotalMedalSP"></select> -->
                            </div>
                        </div>
                        <div class="optSPFilters_flex_section2">
                          <div class="optSPSilderContainers">
                            <h4 class="filterTitlesSP">Year</h4>
                            <div class="sliderRange">
                                <div id="year-slider-range"></div>
                            </div>
                          </div>
                          <div class="optSPSilderContainers">
                              <h4 class="filterTitlesSP">Age</h4>
                              <div class="sliderRange">
                                  <div id="age-slider-range"></div>
                              </div>
                          </div>
                        </div>
                        <div class="optSPFilters_flex_section3">
                          <div class="optSPSilderContainers">
                            <h4 class="filterTitlesSP">Height</h4>
                            <div class="sliderRange">
                                <div id="height-slider-range"></div>
                            </div>
                          </div>
                          <div class="optSPSilderContainers">
                            <h4 class="filterTitlesSP">Weight</h4>
                            <div class="sliderRange">
                                <div id="weight-slider-range"></div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Generate Button: Update Scatterplot Based On Filters -->
            <div class="filterButtonSPflexContainer">
                <div class="generateButtonSP">
                    <button type="button" id="generateButtonSP">Generate</button>
                </div>
                <div id="errorTextSP">
                    <p>Please fill out all required filters.</p>
                </div>
                <div class="resetButtonSP">
                    <button type="button" id="resetButtonSP">Reset</button>
                </div>
            </div>
            <!-- Section 2: Scatterplot Graph and Profile Panel -->
            <div id="flexContainerSP_2">
                <!-- Scatterplot Graph Container -->
                <div id="graphSP">
                    <!-- Scatterplot Graph -->
                    <div id="scatterplotGraph">
                        <svg id="scatterplotGraphSVG" height="600" width="800"></svg>
                    </div>
                    <!-- Scatterplot Legend -->
                    <div id="legendSP">
                        <svg id="scatterlegendsvg" height="100" width="800"></svg>
                    </div>
                </div>
                <!-- Scatterplot Profile Panel -->
                <div id="profilePanelSP">
                  <div id="profilePanelSPflexContainer">
                    <div id="profilePanelSPIntroStatsContainer">
                      <div id="profilePanelSPIntro"></div>
                      <div id="profilePanelSPIntroStats"></div>
                    </div>
                    <div id="profilePanelSPPhysicalTraits">
                      <div id="profilePanelSPTraitsIcon"></div>
                      <div id="profilePanelSPTraitsText"></div>
                    </div>
                  </div>
                    <svg id="profilePanelSPSVG" height="450" width="500"></svg>
                </div>
            </div>

            <!-- ********************************** -->
            <!--    SAVED ATHLETES TABLE            -->
            <!-- ********************************** -->
            <div id="savedAthletesTablePanel">
                <table id="savedAthletesTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th></th>
                            <th>Sport</th>
                            <th>View</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <script>

            /**************************************************
             *****        ScatterPlot Visualization        *****
             **************************************************/

             const scatter = d3.select("svg#scatterplotGraphSVG");
             const scatterLeg = d3.select("svg#scatterlegendsvg");

             const scatterwidth = scatter.attr("width");
             const scatterheight = scatter.attr("height");
             const scattermargin = {
               top: 10,
               right: 10,
               bottom: 60,
               left: 60
             };

             const legWidth = scatterLeg.attr("width");
             const legHeight = scatterLeg.attr("height");

             const widthSP = scatterwidth - scattermargin.left - scattermargin.right;
             const heightSP = scatterheight - scattermargin.top - scattermargin.bottom;

             let annotations = scatter.append("g")
                                 .attr("id", "annotations")
                                 .attr("class", "annotationsSP");

             let areaSP = scatter.append("g").attr("id", "points").attr("class", "pointsSP")
               .attr("transform", "translate(" + scattermargin.left + "," + scattermargin.top + ")");

             let colorLegendGroup = scatterLeg.append('g')
                                 .attr("id", "colorLegendGroup");

           // **************************************************************************************************************

             const loadScatter = async function () {
               var medalistProfileData = await d3.json('medalist_profiles.json');
               var medalistEventsData = await d3.json('medalist_events.json');
               const eventsDataSP = await d3.json('SeasonSportEvents.json');

               var allSport = []
               var allNationality = []
               var allEvent = []

               medalistProfileData.forEach(d => {
                 // if(d['NOC']=="ISV"){
                 //   d['NOC']="USA";
                 // }
                 if (!allNationality.includes(d['NOC'])){
                   allNationality.push(d['NOC'])
                 }
               });

               eventsDataSP.forEach(d => {
                 if (!allSport.includes(d['Sport'])){
                   allSport.push(d['Sport'])
                 }
                 if (!allEvent.includes(d['Event'])){
                   allEvent.push(d['Event'])
                 }
               });

               allSport.sort();
               // allSport.unshift("Select Sport")
               allNationality.sort();
               allNationality.unshift("All Nationalities")
               allEvent.sort();
               allEvent.unshift("All Events")

               var weightMax = Math.max.apply(Math, medalistProfileData.map(function (d) { return d.Weight; }))
                   weightMin = Math.min.apply(Math,medalistProfileData.map(function (d) { return d.Weight; }))
                   heightMax = Math.max.apply(Math, medalistProfileData.map(function (d) { return d.Height; }))
                   heightMin =Math.min.apply(Math, medalistProfileData.map(function (d) { return d.Height; }))
                   ageMax = Math.max.apply(Math, medalistProfileData.map(function (d) { return d.Age; }))
                   ageMin = Math.min.apply(Math,medalistProfileData.map(function (d) { return d.Age; }))
                   yearMax = 2016;
                   yearMin = 1896;

               eventsDataSP.forEach(d => {
                 if(d.Event.match(/Women's/) != null){
                   d["eventGender"] = "F"
                 }else if(d.Event.match(/Men's/) != null){
                   d["eventGender"] = "M"
                 }else{
                   d["eventGender"] = "Mixed"
                 }
               });

               initializeOrResetFiltersSP()
               // Initializing Dropdown Filters
               function initializeOrResetFiltersSP(){
               d3.select("#selectSportSP")
                 .selectAll('myOptions')
                	.data(allSport)
                 .enter()
               	.append('option')
                 .text(function (d) { return d; })
                 .attr("value", function (d) { return d; })
               d3.select("#selectNationalitySP")
                 .selectAll('myOptions')
                	.data(allNationality)
                 .enter()
               	.append('option')
                 .text(function (d) { return d; })
                 .attr("value", function (d) { return d; })
               d3.select("#selectEventSP")
                 .selectAll('myOptions')
                	.data(allEvent)
                 .enter()
               	.append('option')
                 .text(function (d) { return d; })
                 .attr("value", function (d) { return d; })
               }

              // Initializing Slider Filters: Year
                 var yearSlider = d3.sliderBottom()
                   .min(yearMin)
                   .max(yearMax)
                   .width(100)
                   .tickFormat(d3.format(".0f"))
                   .ticks(0)
                   .default([yearMin, yearMax])
                   .fill('#2081c7');

                 var yearSliderSVG = d3.select('#year-slider-range')
                   .append('svg')
                   .attr('width', 175)
                   .attr('height', 100)
                   .append('g')
                   .attr('transform', 'translate(30,30)');

                 yearSliderSVG.call(yearSlider);


                 // Initializing Slider Filters: Age
                    var ageSlider = d3.sliderBottom()
                      .min(ageMin)
                      .max(ageMax)
                      .width(100)
                      .tickFormat(d3.format(".0f"))
                      .ticks(0)
                      .default([ageMin, ageMax])
                      .fill('#2081c7');

                    var ageSliderSVG = d3.select('#age-slider-range')
                      .append('svg')
                      .attr('width', 175)
                      .attr('height', 100)
                      .append('g')
                      .attr('transform', 'translate(30,30)');

                    ageSliderSVG.call(ageSlider);

                    // Initializing Slider Filters: Height
                       var heightSlider = d3.sliderBottom()
                         .min(heightMin)
                         .max(heightMax)
                         .width(100)
                         .tickFormat(d3.format(".0f"))
                         .ticks(0)
                         .default([heightMin, heightMax])
                         .fill('#2081c7');

                       var heightSliderSVG = d3.select('#height-slider-range')
                         .append('svg')
                         .attr('width', 175)
                         .attr('height', 100)
                         .append('g')
                         .attr('transform', 'translate(30,30)');

                       heightSliderSVG.call(heightSlider);

                     // Initializing Slider Filters: Weight
                        var weightSlider = d3.sliderBottom()
                          .min(weightMin)
                          .max(weightMax)
                          .width(100)
                          .tickFormat(d3.format(".0f"))
                          .ticks(0)
                          .default([weightMin, weightMax])
                          .fill('#2081c7');

                        var weightSliderSVG = d3.select('#weight-slider-range')
                          .append('svg')
                          .attr('width', 175)
                          .attr('height', 100)
                          .append('g')
                          .attr('transform', 'translate(30,30)');

                        weightSliderSVG.call(weightSlider);

               // Runs update function when any of the select drop-downs are changed
               d3.select("#generateButtonSP").on("click", function(d) { errorhandling_generateSP() })
               // Runs reset function when reset button is clicked
               d3.select("#resetButtonSP").on("click", function(d) { resetSP() })

                // NEW DATASET (by person no duplicates): ID, Sex, NOC, Sport, Team,
                // Weight, Height, Oldest age competed, Events array, # of olympics,
                // # of gold, silver, bronze medals, Success rate (# of medals/# of olympics),
                // Dictionary of events = {# of gold, # of silver, # of bronze, # of no medals, total # medals},

                var medalistEventsDataDict = {}
                medalistEventsData.forEach(d => {
                  if(d.ID in medalistEventsDataDict){
                    medalistEventsDataDict[d.ID].push(d)
                  }else{
                    medalistEventsDataDict[d.ID] = []
                    medalistEventsDataDict[d.ID].push(d)
                  }
                })
                console.log(medalistEventsDataDict)
                medalistProfileData.forEach(p => {
                  p["Events"] = [];
                  p["EventMedals"] = [];
                  p["YearsCompeted"] = [];
                  p["TotalOlympicEvents"] = 0;
                  p["TotalOlympicMedals"] = 0;
                  medalistEventsDataDict[p.medalistID].forEach (d => {
                    if(p.medalistID == d.ID){
                      p["TotalOlympicEvents"]+=1;
                      if(!(p["YearsCompeted"].includes(d.Year))){
                        p["YearsCompeted"].push(d.Year)
                      }
                      if(!(p["Events"].includes(d.Event))){
                        p["Events"].push(d.Event);
                        if(d["Medal"]=="NA"){
                          p["EventMedals"].push(
                                  { "Event": d.Event,
                                  "Gold": 0,
                                  "Silver": 0,
                                  "Bronze": 0,
                                  "NoMedals": 1
                                  });
                          }else if(d["Medal"]=="Gold"){
                            p["EventMedals"].push(
                                    { "Event": d.Event,
                                    "Gold": 1,
                                    "Silver": 0,
                                    "Bronze": 0,
                                    "NoMedals": 0
                                  });
                          }else if(d["Medal"]=="Silver"){
                            p["EventMedals"].push(
                                    { "Event": d.Event,
                                    "Gold": 0,
                                    "Silver": 1,
                                    "Bronze": 0,
                                    "NoMedals": 0
                                  });
                          }else if(d["Medal"]=="Bronze"){
                            p["EventMedals"].push(
                                    { "Event": d.Event,
                                    "Gold": 0,
                                    "Silver": 0,
                                    "Bronze": 1,
                                    "NoMedals": 0
                                  });
                          }
                        }else{
                            var indexEventMedal = p["EventMedals"].map(function(o) { return o.Event; }).indexOf(d.Event);
                            if(d["Medal"]=="NoMedals"){
                              p["EventMedals"][indexEventMedal]["NoMedals"] += 1;
                            } else if(d["Medal"]=="Gold"){
                              p["EventMedals"][indexEventMedal]["Gold"] += 1;
                            } else if(d["Medal"]=="Silver"){
                              p["EventMedals"][indexEventMedal]["Silver"] += 1;
                            } else if(d["Medal"]=="Bronze"){
                              p["EventMedals"][indexEventMedal]["Bronze"] += 1;
                            }
                          }
                      }
                    });
                    for (event in p.EventMedals){
                      for (numMedals in p.EventMedals[event]){
                        if((numMedals != "NoMedals") && (numMedals != "Event")){
                          p["TotalOlympicMedals"] += p.EventMedals[event][numMedals]
                        }
                      }
                    }
                });
                // **************************************************************************************************************
                // Dynamic filtering dependencies

                //if season radio button changes
              var filteredEventsSPSeason = []
              var filteredSportsSP = []
              var seasonFilter = d => {
                return true;
              }
               d3.selectAll("input[name='seasonSP']").on("change", function(){
                 var selectedSeasonSP = d3.select('input[name="seasonSP"]:checked').property("value");
                  seasonFilter = d => {
                   return (d.Season == selectedSeasonSP)
                 }
                   //
                   //
                   // var selectedSeasonSP = d3.select('input[name="seasonSP"]:checked').property("value");
                   // filteredSportsSP = []
                   // var dataFilterSeasonSP = eventsDataSP.forEach(d => {
                   //   if(d.Season == selectedSeasonSP){
                   //     if(!(filteredSportsSP.includes(d.Sport))){
                   //       filteredSportsSP.push(d.Sport)
                   //     }
                   //   }
                   // });
                   // filteredEventsSPSeason = []
                   // var dataFilterSeasonSP = eventsDataSP.forEach(d => {
                   //   if(d.Season == selectedSeasonSP){
                   //     if(!(filteredEventsSPSeason.includes(d.Event))){
                   //       filteredEventsSPSeason.push(d.Event)
                   //     }
                   //   }
                   // });
                   // filteredEventsSPSeason.unshift("All Events")
                   // filteredSportsSP.unshift("Select Sport")
                   // document.getElementById("selectSportSP").innerHTML = "";
                   // d3.select("#selectSportSP")
                   //   .selectAll('myOptions')
                   //  	.data(filteredSportsSP)
                   //   .enter()
                   // 	.append('option')
                   //   .text(function (d) { return d; })
                   //   .attr("value", function (d) { return d; })
                   // document.getElementById("selectEventSP").innerHTML = "";
                   // d3.select("#selectEventSP")
                   //   .selectAll('myOptions')
                   //    .data(filteredEventsSPSeason)
                   //   .enter()
                   //  .append('option')
                   //   .text(function (d) { return d; })
                   //   .attr("value", function (d) { return d; })
                  //update sport and event dropdowns + year/age/height/weight max and min
                 })

                 //if gender radio button changes
                 var filteredEventsSPGender = []
                 var genderFilter = d => {
                   return true;
                 }
                d3.selectAll("input[name='genderSP']").on("change", function(){
                  var selectedGenderSP = d3.select('input[name="genderSP"]:checked').property("value");
                  genderFilter = d => {
                    return (d.Sex == selectedGenderSP)
                  }
                  // errorhandling_generateSP();
                    // var selectedGenderSP = d3.select('input[name="genderSP"]:checked').property("value");
                    // if(filteredEventsSPSeason.length==0){
                    //   filteredEventsSPGender = []
                    //   filteredEventsSPGender.push("All Events")
                    //   var dataFilterGenderSP = eventsDataSP.forEach(d => {
                    //     if(d.eventGender == selectedGenderSP){
                    //       filteredEventsSPGender.push(d.Event)
                    //     }else if(d.eventGender == "Mixed"){
                    //       filteredEventsSPGender.push(d.Event)
                    //     }
                    //   });
                    //   document.getElementById("selectEventSP").innerHTML = "";
                    //   d3.select("#selectEventSP")
                    //     .selectAll('myOptions')
                    //    	.data(filteredEventsSPGender)
                    //     .enter()
                    //   	.append('option')
                    //     .text(function (d) { return d; })
                    //     .attr("value", function (d) { return d; })
                    // }else{
                    //   filteredEventsSPGender = [];
                    //   var dataFilterGenderSP = eventsDataSP.forEach(d => {
                    //     filteredEventsSPSeason.forEach(p => {
                    //     if((d.eventGender == selectedGenderSP) && (p == d.Event)){
                    //       filteredEventsSPGender.push(d.Event)
                    //     }else if((d.eventGender == "Mixed") && (p == d.Event)){
                    //       filteredEventsSPGender.push(d.Event)
                    //     }
                    //     })
                    //   });
                    //   document.getElementById("selectEventSP").innerHTML = "";
                    //   d3.select("#selectEventSP")
                    //     .selectAll('myOptions')
                    //    	.data(filteredEventsSPGender)
                    //     .enter()
                    //   	.append('option')
                    //     .text(function (d) { return d; })
                    //     .attr("value", function (d) { return d; })
                    // }

                    //update event dropdown + year/age/height/weight max and min
                  })
                  var sportFilter = d => {
                    return false;
                  }
                  d3.select("#selectSportSP").on("change", function(){

                    var selectedSportOptionSP = d3.select("#selectSportSP").property("value")
                     if(selectedSportOptionSP != "Select Sport"){
                       sportFilter = d => {
                         return (d.Sport == selectedSportOptionSP)
                       }
                       }else{
                         sportFilter = d => { return true; }
                       }
                  })

                  //EVENT: based on selection, update year, age, height, weight
                  //NATIONALITY: should these selections change based on others?

                  function filterData(scatterdata){
                    newData = [];
                    scatterdata.forEach(d => {
                      if(seasonFilter(d) && genderFilter(d) && sportFilter(d)){
                        newData.push(d)
                      }
                    })
                    return newData;
                  }

                // **************************************************************************************************************
               //Deletes old points and replaces with new points that fit the criteria of the four filter select options

               function errorhandling_generateSP(){
                 let newData = filterData(medalistProfileData)
                 console.log(newData)
                 try {
                    generateSP(newData);
                  } catch (e) {
                    console.error("Error because required filters weren't selected.");
                    d3.select("#errorTextSP")
                      .style("opacity", 1);
                    // expected output: "Parameter is not a number!"
                  }
               }
               console.log(d3.selectAll('input[type=checkbox]:checked').property("value"))

               function generateSP(newData) {

                 // Create new data with season and gender radio selection
                //  var selectedSeasonOptionSP = d3.select('input[name="seasonSP"]:checked').property("value");
                //  var selectedGenderOptionSP = d3.select('input[name="genderSP"]:checked').property("value");
                //  var dataFilter1 = medalistProfileData.filter(function (d) {
                //    return ((d.Sex == selectedGenderOptionSP) && (d.Season == selectedSeasonOptionSP))
                //  });
                //
                //  // Create new data with sport selection
                //  var selectedSportOptionSP = d3.select("#selectSportSP").property("value")
                //  if(selectedSportOptionSP != "Select Sport"){
                //    var dataFilter2 = dataFilter1.filter(function (d) {
                //      return (d.Sport == selectedSportOptionSP)
                //    });
                //  }
                //
                //  //Create new data with year slider selection
                //  var selectedYearMinSP = yearSlider.value()[0]
                //  var selectedYearMaxSP = yearSlider.value()[1]
                //  var dataFilter3 = dataFilter2.filter(function (d) {
                //    var withinYearBoolean = 0;
                //    for (year in d.YearsCompeted){
                //      if((d.YearsCompeted[year]>=selectedYearMinSP) && (d.YearsCompeted[year]<=selectedYearMaxSP)){
                //        withinYearBoolean += 1;
                //      }
                //    }
                //    return (withinYearBoolean>0)
                //  });
                //
                //  //Create new data with age slider selection
                //  var selectedAgeMinSP = ageSlider.value()[0]
                //  var selectedAgeMaxSP = ageSlider.value()[1]
                //  var dataFilter4 = dataFilter3.filter(function (d) {
                //      return ((d.Age >=selectedAgeMinSP) && (d.Age<=selectedAgeMaxSP))
                //    });
                //
                //  //Create new data with height slider selection
                //  var selectedHeightMinSP = heightSlider.value()[0]
                //  var selectedHeightMaxSP = heightSlider.value()[1]
                //  var dataFilter5 = dataFilter4.filter(function (d) {
                //    return ((d.Height >=selectedHeightMinSP) && (d.Height<=selectedHeightMaxSP))
                //  });
                //
                //  //Create new data with weight slider selection
                //  var selectedWeightMinSP = weightSlider.value()[0]
                //  var selectedWeightMaxSP = weightSlider.value()[1]
                //  var dataFilter6 = dataFilter5.filter(function (d) {
                //    return ((d.Weight >=selectedWeightMinSP) && (d.Weight<=selectedWeightMaxSP))
                //  });
                //
                //
                // // Create new data with event selection
                // var selectedEventOptionSP = d3.select("#selectEventSP").property("value")
                // if(selectedEventOptionSP != "All Events"){
                // // console.log(selectedEventOptionSP)
                //   var dataFilter7 = dataFilter6.filter(function (d) {
                //     // console.log(d.Events)
                //     var eventExistsBoolean = 0;
                //     for (event in d.Events){
                //       // console.log(event)
                //       if(d.Events[event]==selectedEventOptionSP){
                //         eventExistsBoolean += 1;
                //       }
                //     }
                //     // console.log(eventExistsBoolean>0)
                //     return (eventExistsBoolean>0)
                //   });
                // }else{
                //   var dataFilter7 = dataFilter6
                // }
                //
                // // Create new data with nationality selection
                // var selectedNationalityOptionSP = d3.select("#selectNationalitySP").property("value")
                // if(selectedNationalityOptionSP != "All Nationalities"){
                //   var dataFilter8 = dataFilter7.filter(function (d) {
                //     return (d.NOC == selectedNationalityOptionSP)
                //   });
                // }else{
                //   var dataFilter8 = dataFilter7
                // }
                //
                // // Create new data with # of medals selection
                // var checkedTotalMedalsList = []
                // try {
                //    var selectedOneMedalOptionSP = d3.select('input[name="medalsOne"]:checked').property("value");
                //  } catch (e) {
                //    var selectedOneMedalOptionSP = 0
                //  }
                //  try {
                //     var selectedTwoMedalOptionSP = d3.select('input[name="medalsTwo"]:checked').property("value");
                //   } catch (e) {
                //     var selectedTwoMedalOptionSP = 0
                //   }
                //   try {
                //      var selectedThreeMedalOptionSP = d3.select('input[name="medalsThree"]:checked').property("value");
                //    } catch (e) {
                //      var selectedThreeMedalOptionSP = 0
                //    }
                // // var selectedOneMedalOptionSP = d3.select('input[name="medalsOne"]:checked').property("value");
                // // var selectedTwoMedalOptionSP = d3.select('input[name="medalsTwo"]:checked').property("value");
                // // var selectedThreeMedalOptionSP = d3.select('input[name="medalsThree"]:checked').property("value");
                // checkedTotalMedalsList.push(selectedOneMedalOptionSP)
                // checkedTotalMedalsList.push(selectedTwoMedalOptionSP)
                // checkedTotalMedalsList.push(selectedThreeMedalOptionSP)
                // // console.log(checkedTotalMedalsList)
                // var dataFilter9 = dataFilter8.filter(function (d) {
                //   for (checkedbox in checkedTotalMedalsList){
                //     // console.log(d.TotalOlympicMedals)
                //     if(checkedTotalMedalsList[checkedbox] == 1){
                //       // console.log("1+ is true")
                //       return (d.TotalOlympicMedals >= 1)
                //     } else if(checkedTotalMedalsList[checkedbox] == 2){
                //       // console.log("2+ is true")
                //       return (d.TotalOlympicMedals >= 2)
                //     } else if(checkedTotalMedalsList[checkedbox] == 3){
                //       // console.log("3+ is true")
                //       return (d.TotalOlympicMedals >= 3)
                //     }
                //   }
                // });
                //
                //  d3.select("#errorTextSP")
                //    .style("opacity", 0);

               // console.log(dataFilter1.length)
               // console.log(dataFilter2.length)
               // console.log(dataFilter3.length)
               //  console.log(dataFilter4.length)
               //  console.log(dataFilter5.length)
               //  console.log(dataFilter6.length)
               //  console.log(dataFilter7.length)
               //  console.log(dataFilter8.length)
               //  console.log(dataFilter9.length)
                 // areaSP.selectAll("circle.point").remove();
               //
               // Circle Plotting
               let circles = areaSP.selectAll("circle.point").data(newData)
                 .join(enter => enter.append("circle")
                   .attr("class", "point")
                   .attr("opacity", 0.8)
                 )
                 .attr("cx", d => weightScale(d['Weight']))
                 .attr("cy", d => heightScale(d['Height']))
                 .attr("r", d => medalsScale(d['TotalMedals']))
                 .attr("fill", function(d) {
                          return medalsColorScale(d.TopMedal);
                        ;});

                 //Update Saved Movies
                 circles.on("click",function(event,d){
                   updateProfilePanel(d)
                 });
               }


               //Resets all filters
               function resetSP(){
                   d3.select("#selectSportSP").selectAll('myOptions').exit().remove()
                   initializeOrResetFiltersSP()
                   d3.select('input[name="seasonSP"]:checked').attr('checked',null)
                   d3.select('input[name="genderSP"]:checked').attr('checked',null)
                   d3.select('input[name="medalsOne"]:checked').attr('checked',true)
                   d3.select('input[name="medalsTwo"]:checked').attr('checked',true)
                   d3.select('input[name="medalsThree"]:checked').attr('checked',true)
               }

               // **************************************************************************************************************
               // Creating Scales
               const weightScale = d3.scaleLinear().domain([weightMin,weightMax]).range([0,widthSP]);
               const heightScale = d3.scaleLinear().domain([heightMin,heightMax]).range([heightSP,0]);
               const medalsExtent = d3.extent(medalistProfileData, d => d['TotalMedals']);
               const medalsScale = d3.scaleLinear().domain(medalsExtent).range([3, 50]);

               var goldColor = "#e6c90d";
               var silverColor = "#e0dfd2";
               var bronzeColor = "#c16e00";
               var noMedalsColor = "#7cdaeb";

               const medalsColorScale = d3.scaleOrdinal().domain(
                 ["3","2","1"]) //where 1 is bronze, 2 is silver, 3 is gold
                 .range([goldColor,silverColor,bronzeColor]);

               // Y axis
               let leftAxis = d3.axisLeft(heightScale)
                 .tickFormat(d3.format(""));
               let leftGridlines = d3.axisLeft(heightScale)
                 .tickSize(-widthSP)
                 .tickFormat("");

               annotations.append("g")
                 .attr("class", "y axis")
                 .attr("transform", "translate(" + (scattermargin.left) + "," + scattermargin.top + ")")
                 .call(leftAxis)
               annotations.append("g")
                 .attr("class", "y gridlines")
                 .attr("transform", "translate(" + (scattermargin.left) + "," + scattermargin.top + ")")
                 .call(leftGridlines);

               // X axis
               let bottomAxis = d3.axisBottom(weightScale)
                 .tickFormat(d3.format(""));
               let bottomGridlines = d3.axisBottom(weightScale)
                 .tickSize(-heightSP)
                 .tickFormat("");

               annotations.append("g")
                 .attr("class", "x axis")
                 .attr("transform", "translate(" + scattermargin.left + "," + (heightSP + scattermargin.top) + ")")
                 .call(bottomAxis);
               annotations.append("g")
                 .attr("class", "x gridlines")
                 .attr("transform", "translate(" + scattermargin.left + "," + (heightSP + scattermargin.top) + ")")
                 .call(bottomGridlines);

               // Adding Axis Labels

               //Y Axis
               annotations.append("text")
                 .attr("class", "y label")
                 .attr("text-anchor", "middle")
                 .attr("y", 3)
                 .attr("x", (-heightSP/2))
                 .attr("dy", "0.75em")
                 .attr("transform", "rotate(-90)")
                 .style("font-size", "15px")
                 .style("fill", "white")
                 .text("Height (cm)");

               //X Axis
               annotations.append("text")
                 .attr("class", "x label")
                 .attr("text-anchor", "middle")
                 .attr("x", (widthSP/2)+scattermargin.left)
                 .attr("y", heightSP + scattermargin.bottom)
                 .style("font-size", "15px")
                 .style("fill", "white")
                 .text("Weight (kg)");

               // Creating the Legend
                 scatterLeg.append("g")
                   .attr("class", "legend-title")
                   .append("text")
                   .text("Highest Medal")
                   .attr("x",125)
                   .attr("y",30)
                   .style("font-weight","bold")
                   .style("fill", "white")
                   .style("font-size", "15px")
                   .style("text-anchor","start");

                 var legendSP = scatterLeg.selectAll()
                 .data([3,2,1])
                 .enter().append("g")
                 .attr("class", "legendSP")
                 .attr("transform", function(d, i) { return "translate(" + i * 100 +",10)"; });

                 // Draw Colored Circles in the Legend
                 legendSP.append("circle")
                      .attr("cx", 50)
                      .attr("cy", 50)
                      .attr("r", 8)
                      .style("fill", function(d){return medalsColorScale(d)})
                      .attr("transform", function(d, i) { return "translate(-5,0)"; });

                 // Add Corresponding Text in the Legend
                 legendSP.append("text")
                      .attr("x", 60)
                      .attr("y", 50)
                      .attr("dy", ".35em")
                      .style("text-anchor", "start")
                      .style("font-size", "13px")
                      .style("fill", "white")
                      .text(function(d) {
                        if(d==3){
                          return "Gold";
                        }else if(d==2){
                          return "Silver";
                        }else{
                          return "Bronze";
                        }
                      });

                      scatterLeg.append("g")
                        .attr("class", "legend-title2")
                        .append("text")
                        .text("Total Medals")
                        .attr("x",525)
                        .attr("y",30)
                        .style("font-weight","bold")
                        .style("fill", "white")
                        .style("font-size", "15px")
                        .style("text-anchor","start");

                      var legendSP2 = scatterLeg.selectAll()
                      .data([5,10,15,20]) //3 is 1 medal, 12 is 5 medals, 20 is 10 medals, 47 is 25 medals - didn't work? how is radius scale working?
                      .enter().append("g")
                      .attr("class", "legendSP2")
                      .attr("transform", function(d, i) { return "translate(" + i * 100 +",10)"; });

                      // Draw Colored Circles in the Legend
                      legendSP2.append("circle")
                           .attr("cx", 400)
                           .attr("cy", 50)
                           .attr("r", function(d){return medalsScale(d)*.5})
                           .style("fill", "lightgray")
                           .attr("transform", function(d, i) { return "translate(-5,0)"; });

                      // Add Corresponding Text in the Legend
                      legendSP2.append("text")
                           .attr("x", 420)
                           .attr("y", 50)
                           .attr("dy", ".35em")
                           .style("text-anchor", "start")
                           .style("font-size", "13px")
                           .style("fill", "white")
                           .text(function(d) {
                             if(d==5){
                               return "1-2";
                             }else if(d==10){
                               return "3-4";
                             }else if(d==15){
                               return "5-10";
                             }else if(d==20){
                               return "10-30";
                             }
                           });

                 function updateProfilePanel(d){
                   d3.select("#profilePanelSPIntro")
                   .html("<h4><b>"+d.NOC+"</b></h4>"
                   + "<h4><b>"+d.Name+"</b></h4>");

                   d3.select("#profilePanelSPIntroStats")
                   .html("<p><b>Stats:</b></p>"
                   +"<p>"+d.YearsCompeted.length+" Olympics</p>"
                   +"<p>"+d.TotalMedals+" Medals</p>"
                   +"<p>"+parseFloat((d.TotalMedals/d.TotalOlympicEvents)*100).toFixed(0)+"% Success Rate</p>");

                   // d3.select("#profilePanelSPTraitsIcon").selectAll("svg:image").remove()
                   var profilePanelSPGenderIcon = d3.select("#profilePanelSPTraitsIcon").append("svg")
                        .attr("class","profilePanelSPGenderIcon")
                        .attr("width", 100)
                        .attr("height", 100);

                    var iconSP = profilePanelSPGenderIcon.append("g");

                    if (d.Sex == "F"){
                      var img = iconSP.append("svg:image")
                          .attr("xlink:href", "Images/female.svg")
                          .attr("width", 100)
                          .attr("height", 100)
                          .style("fill","white")
                          .attr("x", 10)
                          .attr("y",10);
                    }else{
                      var img = iconSP.append("svg:image")
                          .attr("xlink:href", "Images/male.svg")
                          .attr("width", 100)
                          .attr("height", 100)
                          .style("stroke","white")
                          .attr("x", 10)
                          .attr("y",10);
                    }

                    d3.select("#profilePanelSPTraitsText")
                    .html("<h4><b>"+d.Age+" years old</b></h4>"
                    +"<p>"+d.Height.toFixed(0)+"m | "+d.Weight.toFixed(0)+"kg</p>");

                    //Bar graph

                var stackdata = ["Gold", "Silver", "Bronze", "NoMedals"].map(function(medals) {
                return d.EventMedals.map(function(k,i) { //x: "Event", y0: 0, y: how many medals
                  return {x: k["Event"], y: +k[medals]};
                })});

                for (i=0; i<stackdata.length; i++){
                  if (i==0){
                    for (j=0; j<stackdata[i].length; j++){
                      stackdata[i][j]["y0"] = 0;
                    }
                  }else{
                    for (j=0; j<stackdata[i].length; j++){
                      stackdata[i][j]["y0"] = (stackdata[i-1][j]["y"]+stackdata[i-1][j]["y0"]);
                    }
                  }
                }
                const barGraphSP = d3.select("svg#profilePanelSPSVG")
                const barWidthSP = barGraphSP.attr("width");
                const barHeightSP = barGraphSP.attr("height");
                var barMarginSP = {top: 10, right: 10, bottom: 50, left: 50};
                const barMarginWidth = barWidthSP - barMarginSP.left - barMarginSP.right;
                const barMarginHeight = barHeightSP - barMarginSP.top - barMarginSP.bottom;

                var barGraphSPBars = barGraphSP.append("svg")
                .attr("width", barMarginWidth + barMarginSP.left + barMarginSP.right)
                    .attr("height", barMarginHeight + barMarginSP.top + barMarginSP.bottom)
                    .append("g")
                    .attr("transform",
                          "translate(" + barMarginSP.left + "," + barMarginSP.top + ")");

                var x = d3.scaleBand()
                        .rangeRound([0, barMarginWidth])
                        .padding(0.1);

                var y = d3.scaleLinear()
                        .rangeRound([barMarginHeight, 0]);

                var color = [goldColor,silverColor,bronzeColor,noMedalsColor]

                var xAxis = d3.axisBottom()
                    .scale(x);

                x.domain(stackdata[0].map(function (d) {
                    return d.x;
                }));

                y.domain([0,
                    d3.max(stackdata[stackdata.length - 1],
                            function (d) { return d.y0 + d.y;})
                    ])
                  .nice();

                var layer = barGraphSPBars.selectAll()
                        .data(stackdata)
                        .enter().append("g")
                        .attr("class", "stack")
                        .style("fill", function(d, i) { return color[i]});

                layer.selectAll("rect")
                        .data(function (d) {
                            return d;
                        })
                        .enter().append("rect")
                        .attr("x", function (d) {
                            return x(d.x);
                        })
                        .attr("y", function (d) {
                            return y(d.y + d.y0);
                        })
                        .attr("height", function (d) {
                            return y(d.y0) - y(d.y + d.y0);
                        })
                        .attr("width", 20)
                        .style("stroke","lightgray");

                barGraphSPBars.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0," + barMarginHeight + ")")
                        .call(xAxis);
                   }
                 }

            // requestData();
            loadScatter();
        </script>
    </div>
</body>

</html>
