<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <title>INFO4310 Final Project</title>

    <style>
        body {
            font-family: monaco, Consolas, Lucida Console, monospace;
            background: #f9f9f9;
        }

        .sectionTitles {
            font-size: 60px;
            text-align: center;
        }

        .websiteTitle {
            font-size: 80px;
            text-align: center;
            color: #2e2e2e;
        }

        .authorsTitle {
            font-size: 30px;
            font-style: italic;
            text-align: center;
            color: #2e2e2e;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 1000px;
        }

        .olympicsflexcontainermain {
            height: 750px;
        }

        .olympicsflexcontainertoc {
            margin: auto;
            margin-top: -575px;
            width: 990px;
        }

        .olympicsflexcontainer1,
        .olympicsflexcontainer2 {
            display: flex;
            flex-direction: row;
        }

        .toc_textbox_r1 {
            height: 240px;
            width: 240px;
            border-radius: 50%;
            /* background-color: rgba(38, 38, 38, 0.2); */
            text-align: center;
            margin: 45px;
            display: flex;
        }

        .olympicsflexcontainer2 {
            margin-left: 165px;
            margin-top: -180px;
        }

        .toc_textbox_r2 {
            height: 240px;
            width: 240px;
            border-radius: 50%;
            /* background-color: rgba(38, 38, 38, 0.2); */
            text-align: center;
            margin: 45px;
            display: flex;
        }

        .toc_text {
            text-decoration: none;
            color: #2e2e2e;
            font-weight: bold;
            font-size: 15px;
            margin: auto;
            width: 200px;
        }

        hr.solid {
            border-top: 3px solid #2e2e2e;
        }

        #mapPanel {
            color: #2e2e2e;
            padding-bottom: 2vh;
        }

        #scatterplotPanel {
            background: #14284a;
            position: absolute;
            left: 0;
            right: 0;
            color: white;
        }

        #flexContainerSP_1 {
            display: flex;
            justify-content: center;
            width: 890px;
            height: 275px;
            margin: 30px auto;
            border: 1.5px solid lightgray;
            background: rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        #flexContainerSP_1 h3,
        #generateButtonSP,
        #resetButtonSP,
        #errorTextSP {
            font-size: 15px;
        }

        .filterButtonSPflexContainer {
            display: flex;
            flex-direction: row;
        }

        .filterTitlesSP,
        .filterTitlesMP {
            font-size: 13px;
        }

        #reqSPFilters {
            width: 250px;
            padding: 10px;
            padding-left: 30px;
            text-align: left;
        }

        #selectSportSP,
        #selectNationalitySP,
        #selectEventSP,
        #selectSportMP,
        #selectEventMP {
            width: 175px;
            height: 20px;
        }

        .checkboxMedalsFlexContainer {
            display: flex;
            flex-direction: row;
            margin-top: -2px;
            margin-left: -2px;
        }
        /* .checkboxMedalsFlexContainer label {
          margin-left: 5px;
          margin-right: 15px;
          margin-top: 2px;
        } */

        #optSPFilters {
            width: 600px;
            padding: 10px;
            padding-left: 30px;
            text-align: left;
            border-left: 1.5px solid lightgray;
        }

        .radioGenderSPflexcontainer,
        .radioSeasonSPflexcontainer {
            display: flex;
            flex-direction: row;
            height: 17px;
        }

        .radioGenderSPflexcontainer label,
        .radioSeasonSPflexcontainer label {
            margin-left: 5px;
            margin-right: 15px;
            margin-top: 2px;
        }
        /* Styling for Scatterplot radio button filters */

        .radioSPStyling {
            display: block;
            position: relative;
            padding-left: 25px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 13px;
            font-family: monaco, Consolas, Lucida Console, monospace;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .radioSPStyling input {
            margin-left: 10px;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .radioSPStyling:hover input~.radioDot {
            background-color: #d9f1ff;
        }

        .radioSPStyling input:checked~.radioDot {
            background-color: #2081c7;
        }

        .radioDot {
            position: absolute;
            top: 0;
            left: 0;
            height: 20px;
            width: 20px;
            margin-top: -2px;
            margin-left: -3px;
            background-color: #a3d9f7;
            border-radius: 50%;
        }

        .radioDot:after {
            content: "";
            position: absolute;
            display: none;
        }

        .radioSPStyling input:checked~.radioDot:after {
            display: block;
        }

        .radioSPStyling .radioDot:after {
            top: 6px;
            left: 6px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }
        /* Styling for Scatterplot checkbox filters */

        .checkboxSPStyling {
            display: block;
            position: relative;
            padding-left: 25px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 13px;
            font-family: monaco, Consolas, Lucida Console, monospace;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .checkboxSPStyling input {
            margin-left: 10px;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkboxSPStyling:hover input~.checkmark {
            background-color: #d9f1ff;
        }

        .checkboxSPStyling input:checked~.checkmark {
            background-color: #2081c7;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 15px;
            width: 15px;
            background-color: #a3d9f7;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkboxSPStyling input:checked~.checkmark:after {
            display: block;
        }

        .checkboxSPStyling .checkmark:after {
            left: 4px;
            top: 0px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }
        /* Styling for Scatterplot dropdown filters */

        #selectSportSP,
        #selectNationalitySP,
        #selectEventSP {
            font-family: monaco, Consolas, Lucida Console, monospace;
            stroke: none;
            background-color: #2081c7;
            color: white;
            border: 0px;
            outline: 0px;
            border-radius: 5px;
            padding: 0 1em;
        }

        .reqSPFilters_flexContainer label {
            font-size: 13px;
        }

        .reqSPFilters_flexContainer {
            display: flex;
            flex-direction: column;
            margin-top: -15px;
        }

        .optSPFilters_flexContainer {
            display: flex;
            flex-direction: row;
            margin-top: -15px;
        }

        .optSPFilters_flex_section1 {
            width: 200px;
        }

        .optSPFilters_flex_section2,
        .optSPFilters_flex_section3 {
            width: 200px;
        }

        .optSPFilters_flexContainer select,
        .reqSPFilters_flexContainer select {
            margin-top: -5px;
        }

        .optSPSilderContainers {
            height: 90px;
            ;
        }

        .sliderRange {
            margin-left: -10px;
            margin-top: -25px;
        }

        .sliderRange text {
            fill: white;
            font-size: 12px;
            font-family: monaco, Consolas, Lucida Console, monospace;
        }

        .generateButtonSP,
        .resetButtonSP,
        #errorTextSP {
            text-align: center;
            margin: auto;
        }

        #errorTextSP {
            font-style: italic;
            font-weight: bold;
            color: #af2323;
            width: 400px;
            opacity: 0%;
        }

        #generateButtonSP,
        #resetButtonSP {
            font-family: monaco, Consolas, Lucida Console, monospace;
            font-weight: bold;
            background-color: #f9f9f9;
            border: 1.5px solid lightgray;
            padding: 5px;
            padding-left: 20px;
            padding-right: 20px;
        }

        #flexContainerSP_2 {
            display: flex;
            justify-content: center;
        }

        #graphSP,
        #profilePanelSP {
            margin-top: 30px;
            margin-bottom: 30px;
            margin-right: 30px;
            height: 700px;
        }

        #graphSP,
        #legendSP {
            width: 800px;
        }

        #profilePanelSP {
            width: 600px;
            padding-bottom: 20px;
        }

        #profilePanelSPflexContainer {
            display: flex;
            flex-direction: row;
        }

        #profilePanelSPIntroStatsContainer {
            height: 250px;
            width: 300px;
            padding-top: 20px;
            padding-left: 20px;
        }

        #profilePanelSPIntroStats p {
            margin: 0;
            font-size: 15px;
            padding-bottom: 5px;
        }

        #profilePanelSPIntro h4 {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
            padding-bottom: 5px;
        }

        #profilePanelSPIntro {
            padding-bottom: 20px;
        }

        #profilePanelSPPhysicalTraits {
            height: 250px;
            width: 300px;
        }

        #profilePanelSPTraitsText {
            text-align: center;
            width: 140px;
            padding-left: 160px;
        }

        #profilePanelSPTraitsIcon {
            text-align: right;
            padding-right: 30px;
        }

        #profilePanelSPTraitsText h4,
        #profilePanelSPTraitsText p {
            font-size: 13px;
            margin: 0;
        }
        /* #scatterlegendsvg {
            background-color: rgba(255, 255, 255, 0.1);
        } */

        .y.axis text,
        .x.axis text {
            font-size: 13px;
        }
        /* #profilePanelSPSVG {
            padding-left: 20px;
        } */

        #savedAthletesTablePanel {
            margin-top: 100px;
            padding: 20px;
            height: 800px;
        }

        #savedAthletesTable {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1.5px solid lightgray;
            width: 1400px;
            margin: auto;
        }

        #viz {
            height: 130vh;
            text-align: center;
            margin-bottom: 5vh;
        }

        .boundary {
            fill: #DEB887;
            stroke: black;
            stroke-width: 1px;
        }

        #flexContainerMP_1 {
            display: flex;
            justify-content: center;
        }

        #map_svg {
            border: 2px solid rgb(230, 238, 247);
            background-color: rgb(230, 238, 247);
        }

        #timeline {
            text-align: center;
            position: relative;
            /* top: 600px; */
        }

        #optMapFilters {
            width: 600px;
            height: 250px;
            text-align: center;
            border: 1px solid #000;
            display: inline-block;
            margin-top: 5vh;
            background-color: rgb(238, 238, 238);
        }

        .optMapFilters_flexContainer {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
        }

        #map_opt_title {
            border-bottom: 1px solid #000;
        }

        #map_opt_title_div {
            width: 14vw;
            display: inline-block;
        }

        .optMPFilters_flexContainer_medals {
            display: flex;
            flex-direction: row;
            text-align: left;
            font-size: 13px;
        }

        #selectGoldMP,
        #selectSilverMP,
        #selectBronzeMP,
        #summerMP,
        #winterMP {
            width: 40px;
            height: 20px;
        }

        .radioSeasonMP {
            text-align: left;
            font-size: 13px;
        }

        .row {
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            /* margin-right: -15px; */
            margin-left: -15px
        }

        .align-items-center {
            -ms-flex-align: center!important;
            align-items: center!important
        }

        .col-sm,
        .col-sm-2 {
            position: relative;
            width: 100%;
            min-height: 1px;
            display: flex;
            justify-content: center;
        }

        .time_year {
            padding-top: 5px;
            font-size: 13px;
        }
        /* .xlabel, .ylabel{
          font-size: 13px;
          color: white;
        } */
    </style>
</head>

<body>
    <div id='p1'>
        <!-- ********************************** -->
        <!--         INTRO SECTION              -->
        <!-- ********************************** -->
        <h1 class="websiteTitle">Olympics Tracker</h1>
        <h1 class="authorsTitle">By Marcella Imoisili & Kristy Liu</h1>
        <div class="olympicsflexcontainermain">
            <img src="Images/olympics.png" alt="Olympics Logo" class="center">
            <div class="olympicsflexcontainertoc">
                <div class="olympicsflexcontainer1">
                    <div class="toc_textbox_r1">
                        <a href="#mapPanel" class="toc_text">1. How the Olympics Have Changed Since 1896</a>
                    </div>
                    <div class="toc_textbox_r1">
                        <a href="#mapPanel" class="toc_text">2. World Map of Olympics Results</a>
                    </div>
                    <div class="toc_textbox_r1">
                        <a href="#scatterplotPanel" class="toc_text">3. Athlete Profiles</a>
                    </div>
                </div>
                <div class="olympicsflexcontainer2">
                    <div class="toc_textbox_r2">
                        <a href="#savedAthletesTablePanel" class="toc_text">4. Saved Athletes</a>
                    </div>
                    <div class="toc_textbox_r2">
                        <a href="#scatterplotPanel" class="toc_text">5. Citations</a>
                    </div>
                </div>
            </div>
        </div>
        <hr class="solid">
        <!-- ********************************** -->
        <!--         MAP VISUALIZATION          -->
        <!-- ********************************** -->
        <div id="mapPanel">
            <h1 class="sectionTitles">World Map of Olympics Results</h1>
            <div id='viz'>
                <div id="flexContainerMP_1">
                </div>
                <!-- <div id="timeline"> -->
                <div class="row align-items-center">
                    <div class="col-sm">
                        <div id="slider-time"></div>
                        <h3 class="time_year">Year</h3>
                    </div>
                    <div class="col-sm-2">
                        <p id="value-time"></p>
                    </div>
                </div>
                <!-- <input id="timeslide" type="range" min="0" max="15" value="0" step="1" /><br>
                    <span id="range">1896</span> -->
                <!-- </div> -->

                <!-- Optional Filters -->
                <div id="optMapFilters">
                    <div id="map_opt_title_div">
                        <h3 id="map_opt_title">Optional Filters</h3>
                    </div>
                    <div class="optMapFilters_flexContainer">

                        <div class="selectSportMP">
                            <h4 class="filterTitlesMP">Sport</h4>
                            <select id="selectSportMP"></select>
                            <h4 class="filterTitlesMP">Event</h4>
                            <select id="selectEventMP"></select>
                        </div>

                        <div class="optMPFilters_flexContainer_medals">
                            <div class="optMPFilters_flex_medals_titles">
                                <h4 class="filterTitlesMP"># of Medals</h4>
                                <input type="checkbox" id="selectGoldMP" name="selectGoldMP" value="Gold">Gold<br>
                                <input type="checkbox" id="selectSilverMP" name="selectSilverMP" value="Silver">Silver<br>
                                <input type="checkbox" id="selectBronzeMP" name="selectBronzeMP" value="Bronze">Bronze <br>

                            </div>
                        </div>

                        <div class="radioSeasonMP">
                            <h4 class="filterTitlesMP">Season</h4>
                            <input type="checkbox" id="summerMP" name="seasonMP" value="summer">Summer<br>
                            <input type="checkbox" id="winterMP" name="seasonMP" value="winter">Winter<br>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ********************************** -->
        <!--   SCATTERPLOT VISUALIZATION        -->
        <!-- ********************************** -->
        <div id="scatterplotPanel">
            <h1 class="sectionTitles">Athlete Profiles</h1>
            <!-- Section 1: Scatterplot Filters Panel -->
            <div id="flexContainerSP_1">
                <!-- Required Filters -->
                <div id="reqSPFilters">
                    <h3><b>Required Filters:</b></h3>
                    <div class="reqSPFilters_flexContainer">
                        <div class="radioSeasonSP">
                            <h4 class="filterTitlesSP">Season</h4>
                            <div class="radioSeasonSPflexcontainer">
                                <label class="radioSPStyling" for="summerSP">Summer
                                <input type="radio" id="summerSP" name="seasonSP" value="Summer">
                                <span class="radioDot"></span>
                              </label><br>
                                <label class="radioSPStyling" for="winterSP">Winter
                                <input type="radio" id="winterSP" name="seasonSP" value="Winter">
                                <span class="radioDot"></span>
                              </label><br>
                            </div>
                        </div>
                        <div class="selectSportSP">
                            <h4 class="filterTitlesSP">Sport</h4>
                            <select name="selectSportSP" id="selectSportSP"></select>
                        </div>
                        <div class="radioGenderSP">
                            <h4 class="filterTitlesSP">Gender</h4>
                            <div class="radioGenderSPflexcontainer">
                                <label class="radioSPStyling" for="maleSP">Male
                                <input type="radio" id="maleSP" name="genderSP" value="M">
                                <span class="radioDot"></span>
                              </label><br>
                                <label class="radioSPStyling" for="femaleSP">Female
                                <input type="radio" id="femaleSP" name="genderSP" value="F">
                                <span class="radioDot"></span>
                              </label><br>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Optional Filters -->
                <div id="optSPFilters">
                    <h3><b>Optional Filters:</b></h3>
                    <div class="optSPFilters_flexContainer">
                        <div class="optSPFilters_flex_section1">
                            <h4 class="filterTitlesSP">Nationality</h4>
                            <select id="selectNationalitySP"></select>
                            <h4 class="filterTitlesSP">Event</h4>
                            <select id="selectEventSP"></select>
                            <h4 class="filterTitlesSP"># of Medals</h4>
                            <div class="checkboxMedalsFlexContainer">
                                <label class="checkboxSPStyling" for="medalsOne">1+
                                  <input type="checkbox" id="medalsOne" name="medalsOne" value="1" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                                <label class="checkboxSPStyling" for="medalsTwo">2+
                                  <input type="checkbox" id="medalsTwo" name="medalsTwo" value="2" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                                <label class="checkboxSPStyling" for="medalsThree">3+
                                  <input type="checkbox" id="medalsThree" name="medalsThree" value="3" checked>
                                  <span class="checkmark"></span>
                                </label><br>
                                <!-- <select id="selectTotalMedalSP"></select> -->
                            </div>
                        </div>
                        <div class="optSPFilters_flex_section2">
                            <div class="optSPSilderContainers">
                                <h4 class="filterTitlesSP">Year</h4>
                                <div class="sliderRange">
                                    <div id="year-slider-range"></div>
                                </div>
                            </div>
                            <div class="optSPSilderContainers">
                                <h4 class="filterTitlesSP">Age</h4>
                                <div class="sliderRange">
                                    <div id="age-slider-range"></div>
                                </div>
                            </div>
                        </div>
                        <div class="optSPFilters_flex_section3">
                            <div class="optSPSilderContainers">
                                <h4 class="filterTitlesSP">Height</h4>
                                <div class="sliderRange">
                                    <div id="height-slider-range"></div>
                                </div>
                            </div>
                            <div class="optSPSilderContainers">
                                <h4 class="filterTitlesSP">Weight</h4>
                                <div class="sliderRange">
                                    <div id="weight-slider-range"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Generate Button: Update Scatterplot Based On Filters -->
            <div class="filterButtonSPflexContainer">
                <div class="generateButtonSP">
                    <button type="button" id="generateButtonSP">Generate</button>
                </div>
                <div id="errorTextSP">
                    <p>Please fill out all required filters.</p>
                </div>
                <div class="resetButtonSP">
                    <button type="button" id="resetButtonSP">Reset</button>
                </div>
            </div>
            <!-- Section 2: Scatterplot Graph and Profile Panel -->
            <div id="flexContainerSP_2">
                <!-- Scatterplot Graph Container -->
                <div id="graphSP">
                    <!-- Scatterplot Graph -->
                    <div id="scatterplotGraph">
                        <svg id="scatterplotGraphSVG" height="600" width="800"></svg>
                    </div>
                    <!-- Scatterplot Legend -->
                    <div id="legendSP">
                        <svg id="scatterlegendsvg" height="100" width="800"></svg>
                    </div>
                </div>
                <!-- Scatterplot Profile Panel -->
                <div id="profilePanelSP">
                    <div id="profilePanelSPflexContainer">
                        <div id="profilePanelSPIntroStatsContainer">
                            <div id="profilePanelSPIntro"></div>
                            <div id="profilePanelSPIntroStats"></div>
                        </div>
                        <div id="profilePanelSPPhysicalTraits">
                            <div id="profilePanelSPTraitsIcon"></div>
                            <div id="profilePanelSPTraitsText"></div>
                        </div>
                    </div>
                    <svg id="profilePanelSPSVG" height="450" width="500"></svg>
                </div>
            </div>

            <!-- ********************************** -->
            <!--    SAVED ATHLETES TABLE            -->
            <!-- ********************************** -->
            <div id="savedAthletesTablePanel">
                <table id="savedAthletesTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th></th>
                            <th>Sport</th>
                            <th>View</th>
                            <th>Remove</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <script>
            /**************************************************
             **********        Map Visualization        ********
             **************************************************/

            //Map
            var width = 950,
                height = 550;

            var projection = d3.geoMercator()
                .scale(153)
                .translate([width / 2, height / 1.5])

            var path = d3.geoPath().projection(projection);


            var map = d3.select("#flexContainerMP_1").append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("id", "map_svg");

            var g = map.append("g").attr("class", "boundary");

            d3.json("countries-110m.json").then(function(topology) {

                g.selectAll("path")
                    .data(topojson.feature(topology, topology.objects.countries).features)
                    .enter().append("path")
                    .attr("d", path);

            });

            // Year inspired by: https://bl.ocks.org/johnwalley/e1d256b81e51da68f7feb632a53c3518
            var dataTime = d3.range(0, 16).map(function(d) {
                return new Date(1896 + (8 * d), 10, 3);
            });

            var sliderTime = d3
                .sliderBottom()
                .min(d3.min(dataTime))
                .max(d3.max(dataTime))
                .step(1000 * 60 * 60 * 24 * 365 * 8)
                .width(900)
                .tickFormat(d3.timeFormat('%Y'))
                .tickValues(dataTime)
                .default(new Date(1896, 10, 3))
                .on('onchange', val => {
                    d3.select('p#value-time').text(d3.timeFormat('%Y')(val));
                });

            var gTime = d3
                .select('div#slider-time')
                .append('svg')
                .attr('width', 950)
                .attr('height', 100)
                .append('g')
                .attr('transform', 'translate(30,30)');

            gTime.call(sliderTime);

            d3.select('p#value-time').text(d3.timeFormat('%Y')(sliderTime.value()));

            /**************************************************
             *****        ScatterPlot Visualization        *****
             **************************************************/

            const scatter = d3.select("svg#scatterplotGraphSVG");
            const scatterLeg = d3.select("svg#scatterlegendsvg");

            const scatterwidth = scatter.attr("width");
            const scatterheight = scatter.attr("height");
            const scattermargin = {
                top: 10,
                right: 10,
                bottom: 60,
                left: 60
            };

            const legWidth = scatterLeg.attr("width");
            const legHeight = scatterLeg.attr("height");

            const widthSP = scatterwidth - scattermargin.left - scattermargin.right;
            const heightSP = scatterheight - scattermargin.top - scattermargin.bottom;

            let annotations = scatter.append("g")
                .attr("id", "annotations")
                .attr("class", "annotationsSP");

            let areaSP = scatter.append("g").attr("id", "points").attr("class", "pointsSP")
                .attr("transform", "translate(" + scattermargin.left + "," + scattermargin.top + ")");

            let colorLegendGroup = scatterLeg.append('g')
                .attr("id", "colorLegendGroup");

            // **************************************************************************************************************

            const requestData = async function() {
                var medalistProfileData = await d3.json('medalist_profiles.json');
                var medalistEventsData = await d3.json('medalist_events.json');
                const eventsDataSP = await d3.json('SeasonSportEvents.json');

                eventsDataSP.forEach(d => {
                    //Make a New Column eventGender Based on Event Name Text
                    //Make Event Name Text Shorter
                    if (d.Event.match(/Women's/) != null) {
                        d["eventGender"] = "F";
                        // d["Event"] = d.Event.split("men's ").pop().trim();
                    } else if (d.Event.match(/Men's/) != null) {
                        d["eventGender"] = "M";
                        // d["Event"] = d.Event.split("Men's ").pop().trim();
                    } else {
                        d["eventGender"] = "Mixed";
                        // d["Event"] = "Mixed " + d.Event.split('Mixed ').pop().trim();
                    }
                });

                var map_data = await d3.csv('athlete_events_filtered.csv', d3.autoType);
                var iso_data = await d3.csv('iso_3digit_alpha_country_codes.csv', d3.autoType);


                // Create World Dictionary for Map Visualization
                var world_dict = {};
                map_data.forEach(d => {
                    if (!world_dict.hasOwnProperty(d["NOC"])) {
                        world_dict[d["NOC"]] = {};
                    }
                    if (!world_dict[d["NOC"]].hasOwnProperty(d["Year"])) {
                        world_dict[d["NOC"]][d["Year"]] = {};
                    }
                    if (!world_dict[d["NOC"]][d["Year"]].hasOwnProperty("Gold")) {
                        world_dict[d["NOC"]][d["Year"]]["Gold"] = 0;
                    }
                    if (!world_dict[d["NOC"]][d["Year"]].hasOwnProperty("Silver")) {
                        world_dict[d["NOC"]][d["Year"]]["Silver"] = 0;
                    }
                    if (!world_dict[d["NOC"]][d["Year"]].hasOwnProperty("Bronze")) {
                        world_dict[d["NOC"]][d["Year"]]["Bronze"] = 0;
                    }
                    if (!world_dict[d["NOC"]][d["Year"]].hasOwnProperty("Total")) {
                        world_dict[d["NOC"]][d["Year"]]["Total"] = 0;
                    } else {
                        if (d["Medal"] == "Gold") {
                            world_dict[d["NOC"]][d["Year"]]["Gold"] += 1;
                        }
                        if (d["Medal"] == "Silver") {
                            world_dict[d["NOC"]][d["Year"]]["Silver"] += 1;
                        }
                        if (d["Medal"] == "Bronze") {
                            world_dict[d["NOC"]][d["Year"]]["Bronze"] += 1;
                        }
                        world_dict[d["NOC"]][d["Year"]]["Total"] = world_dict[d["NOC"]][d["Year"]]["Bronze"] + world_dict[d["NOC"]][d["Year"]]["Silver"] + world_dict[d["NOC"]][d["Year"]]["Gold"];
                    }
                });

                //Create new dictionary for medalistEventsData to reduce data loading times
                var medalistEventsDataDict = {}
                medalistEventsData.forEach(d => {
                    if (d.ID in medalistEventsDataDict) {
                        medalistEventsDataDict[d.ID].push(d)
                    } else {
                        medalistEventsDataDict[d.ID] = []
                        medalistEventsDataDict[d.ID].push(d)
                    }
                    // if (d.Event.match(/Mixed/) != null) {
                    //     d["Event"] = "Mixed " + d.Event.split('Mixed ').pop().trim();
                    // } else if (d.Event.match(/men's/) != null) {
                    //     d["Event"] = d.Event.split("men's ").pop().trim();
                    // } else {
                    //     d["Event"] = d.Event.split("Men's ").pop().trim();
                    // }
                });

                //Create new dictionary to merge events dictionary with athlete profiles array based on ID
                medalistProfileData.forEach(p => {
                    p["Events"] = [];
                    p["EventMedals"] = [];
                    p["YearsCompeted"] = [];
                    p["TotalOlympicEvents"] = 0;
                    p["TotalOlympicMedals"] = 0;
                    medalistEventsDataDict[p.medalistID].forEach(d => {
                        if (p.medalistID == d.ID) {
                            p["TotalOlympicEvents"] += 1;
                            if (!(p["YearsCompeted"].includes(d.Year))) {
                                p["YearsCompeted"].push(d.Year)
                            }
                            if (!(p["Events"].includes(d.Event))) {
                                p["Events"].push(d.Event);
                                if (d["Medal"] == "NA") {
                                    p["EventMedals"].push({
                                        "Event": d.Event,
                                        "Gold": 0,
                                        "Silver": 0,
                                        "Bronze": 0,
                                        "NoMedals": 1
                                    });
                                } else if (d["Medal"] == "Gold") {
                                    p["EventMedals"].push({
                                        "Event": d.Event,
                                        "Gold": 1,
                                        "Silver": 0,
                                        "Bronze": 0,
                                        "NoMedals": 0
                                    });
                                } else if (d["Medal"] == "Silver") {
                                    p["EventMedals"].push({
                                        "Event": d.Event,
                                        "Gold": 0,
                                        "Silver": 1,
                                        "Bronze": 0,
                                        "NoMedals": 0
                                    });
                                } else if (d["Medal"] == "Bronze") {
                                    p["EventMedals"].push({
                                        "Event": d.Event,
                                        "Gold": 0,
                                        "Silver": 0,
                                        "Bronze": 1,
                                        "NoMedals": 0
                                    });
                                }
                            } else {
                                var indexEventMedal = p["EventMedals"].map(function(o) {
                                    return o.Event;
                                }).indexOf(d.Event);
                                if (d["Medal"] == "NoMedals") {
                                    p["EventMedals"][indexEventMedal]["NoMedals"] += 1;
                                } else if (d["Medal"] == "Gold") {
                                    p["EventMedals"][indexEventMedal]["Gold"] += 1;
                                } else if (d["Medal"] == "Silver") {
                                    p["EventMedals"][indexEventMedal]["Silver"] += 1;
                                } else if (d["Medal"] == "Bronze") {
                                    p["EventMedals"][indexEventMedal]["Bronze"] += 1;
                                }
                            }
                        }
                    });
                    for (event in p.EventMedals) {
                        for (numMedals in p.EventMedals[event]) {
                            if ((numMedals != "NoMedals") && (numMedals != "Event")) {
                                p["TotalOlympicMedals"] += p.EventMedals[event][numMedals]
                            }
                        }
                    }
                });

                // console.log(world_dict);
                // console.log(map_data);
                // console.log(iso_data);
                // console.log(medalistProfileData);
                // console.log(medalistEventsData);
                // console.log(medalistEventsDataDict);
                // console.log(eventsDataSP);
                var allSport = []
                var allNationality = Object.keys(world_dict);
                var allEvent = []
                eventsDataSP.forEach(d => {
                    if (!allSport.includes(d['Sport'])) {
                        allSport.push(d['Sport'])
                    }
                    if (!allEvent.includes(d['Event'])) {
                        allEvent.push(d['Event'])
                    }
                });

                allSport.sort();
                allSport.unshift("Select Sport")
                allNationality.sort();
                allNationality.unshift("All Nationalities")
                allEvent.sort();
                allEvent.unshift("All Events")

                var weightMax = Math.max.apply(Math, medalistProfileData.map(function(d) {
                    return d.Weight;
                }))
                weightMin = Math.min.apply(Math, medalistProfileData.map(function(d) {
                    return d.Weight;
                }))
                heightMax = Math.max.apply(Math, medalistProfileData.map(function(d) {
                    return d.Height;
                }))
                heightMin = Math.min.apply(Math, medalistProfileData.map(function(d) {
                    return d.Height;
                }))
                ageMax = Math.max.apply(Math, medalistProfileData.map(function(d) {
                    return d.Age;
                }))
                ageMin = Math.min.apply(Math, medalistProfileData.map(function(d) {
                    return d.Age;
                }))
                yearMax = 2016;
                yearMin = 1896;

                var yearSlider;
                var ageSlider;
                var heightSlider;
                var weightSlider;

                initialStateSP(); //initializing filters
                // Initializing or resetting drop down filters
              function initialStateSP(){
                d3.select("#selectSportSP")
                    .selectAll('myOptions')
                    .data(allSport)
                    .enter()
                    .append('option')
                    .text(function(d) {
                        return d;
                    })
                    .attr("value", function(d) {
                        return d;
                    })


                d3.select("#selectNationalitySP")
                    .selectAll('myOptions')
                    .data(allNationality)
                    .enter()
                    .append('option')
                    .text(function(d) {
                        return d;
                    })
                    .attr("value", function(d) {
                        return d;
                    })

                d3.select("#selectEventSP")
                    .selectAll('myOptions')
                    .data(allEvent)
                    .enter()
                    .append('option')
                    .text(function(d) {
                        return d;
                    })
                    .attr("value", function(d) {
                        return d;
                    })

                     yearSlider = d3.sliderBottom()
                        .min(yearMin)
                        .max(yearMax)
                        .width(100)
                        .tickFormat(d3.format(".0f"))
                        .ticks(0)
                        .default([yearMin, yearMax])
                        .fill('#2081c7');

                    var yearSliderSVG = d3.select('#year-slider-range')
                        .append('svg')
                        .attr('width', 175)
                        .attr('height', 100)
                        .append('g')
                        .attr('transform', 'translate(30,30)');

                    yearSliderSVG.call(yearSlider);


                    // Initializing Slider Filters: Age
                     ageSlider = d3.sliderBottom()
                        .min(ageMin)
                        .max(ageMax)
                        .width(100)
                        .tickFormat(d3.format(".0f"))
                        .ticks(0)
                        .default([ageMin, ageMax])
                        .fill('#2081c7');

                    var ageSliderSVG = d3.select('#age-slider-range')
                        .append('svg')
                        .attr('width', 175)
                        .attr('height', 100)
                        .append('g')
                        .attr('transform', 'translate(30,30)');

                    ageSliderSVG.call(ageSlider);

                    // Initializing Slider Filters: Height
                     heightSlider = d3.sliderBottom()
                        .min(heightMin)
                        .max(heightMax)
                        .width(100)
                        .tickFormat(d3.format(".0f"))
                        .ticks(0)
                        .default([heightMin, heightMax])
                        .fill('#2081c7');

                    var heightSliderSVG = d3.select('#height-slider-range')
                        .append('svg')
                        .attr('width', 175)
                        .attr('height', 100)
                        .append('g')
                        .attr('transform', 'translate(30,30)');

                    heightSliderSVG.call(heightSlider);

                    // Initializing Slider Filters: Weight
                     weightSlider = d3.sliderBottom()
                        .min(weightMin)
                        .max(weightMax)
                        .width(100)
                        .tickFormat(d3.format(".0f"))
                        .ticks(0)
                        .default([weightMin, weightMax])
                        .fill('#2081c7');

                    var weightSliderSVG = d3.select('#weight-slider-range')
                        .append('svg')
                        .attr('width', 175)
                        .attr('height', 100)
                        .append('g')
                        .attr('transform', 'translate(30,30)');

                    weightSliderSVG.call(weightSlider);
              }



                // **************************************************************************************************************

                // Runs update function when any of the select drop-downs are changed
                d3.select("#generateButtonSP").on("click", function(d) {
                        errorhandling_generateSP()
                    })
                    // Runs reset function when reset button is clicked
                d3.select("#resetButtonSP").on("click", function(d) {
                    resetSP()
                })

                function filterData_season_gender(scatterdata) {
                    let newData1 = [];
                    let newData2 = [];
                    scatterdata.forEach(d => {
                        if (seasonFilter(d) && genderFilter(d)) {
                            newData1.push(d)
                        }
                        if (seasonFilter(d) && genderFilter(d) && sportFilter(d)) {
                            newData2.push(d)
                        }
                    })
                    return [newData1,newData2];
                }

                function changeSeasonFilter(allSportUpdated){
                  allSportUpdated.sort();
                  allSportUpdated.unshift("Select Sport")
                  console.log(allSportUpdated)
                  document.getElementById("selectSportSP").innerHTML = "";
                  d3.select("#selectSportSP")
                      .selectAll('myOptions')
                      .data(allSportUpdated)
                      .enter()
                      .append('option')
                      .text(function(d) {
                          return d;
                      })
                      .attr("value", function(d) {
                          return d;
                      })
                }

                function changeNationalityAndEventFilter(allNationalityUpdated,allEventUpdated){
                  allNationalityUpdated.sort();
                  allNationalityUpdated.unshift("All Nationalities")
                  console.log(allNationalityUpdated)
                  document.getElementById("selectNationalitySP").innerHTML = "";
                  d3.select("#selectNationalitySP")
                      .selectAll('myOptions')
                      .data(allNationalityUpdated)
                      .enter()
                      .append('option')
                      .text(function(d) {
                          return d;
                      })
                      .attr("value", function(d) {
                          return d;
                      })
                  allEventUpdated.sort();
                  allEventUpdated.unshift("All Events")
                  console.log(allEventUpdated)
                  document.getElementById("selectEventSP").innerHTML = "";
                  d3.select("#selectEventSP")
                      .selectAll('myOptions')
                      .data(allEventUpdated)
                      .enter()
                      .append('option')
                      .text(function(d) {
                          return d;
                      })
                      .attr("value", function(d) {
                          return d;
                      })
                }

                // Updating Filter Options
                function updateFiltersSP() {
                    var updateFiltersData = filterData_season_gender(medalistProfileData)
                    // console.log(medalistProfileData.length)
                    // console.log(updateFiltersData.length)
                        // Updating Drop Down Options
                    var allSportUpdated = []
                    var allNationalityUpdated = []
                    var allEventUpdated = []
                    var allNationalityUpdated2 = []
                    var allEventUpdated2 = []
                    updateFiltersData[1].forEach(d => {
                        for (event in d['Events']){
                          if (!allEventUpdated.includes(d['Events'][event])) {
                              allEventUpdated.push(d['Events'][event])
                          }
                        }
                        if (!allNationalityUpdated.includes(d['NOC'])) {
                            allNationalityUpdated.push(d['NOC'])
                        }
                    });
                    updateFiltersData[0].forEach(d => {
                      if (!allSportUpdated.includes(d['Sport'])) {
                          allSportUpdated.push(d['Sport'])
                      }
                      for (event in d['Events']){
                        if (!allEventUpdated2.includes(d['Events'][event])) {
                            allEventUpdated2.push(d['Events'][event])
                        }
                      }
                      if (!allNationalityUpdated2.includes(d['NOC'])) {
                          allNationalityUpdated2.push(d['NOC'])
                      }
                    });

                    if(lastSelected=="season"){
                      changeSeasonFilter(allSportUpdated)
                      changeNationalityAndEventFilter(allNationalityUpdated2,allEventUpdated2)
                      sportInitialSelect = 0;
                          eventFilter = d => { return true; }
                          nationalityFilter = d => { return true; }
                    }else{
                      changeNationalityAndEventFilter(allNationalityUpdated,allEventUpdated)
                    }


                    //
                    // // Initializing Slider Filters: Year
                    // var weightMaxNew = Math.max.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Weight;
                    // }))
                    // weightMinNew = Math.min.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Weight;
                    // }))
                    // heightMaxNew = Math.max.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Height;
                    // }))
                    // heightMinNew = Math.min.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Height;
                    // }))
                    // ageMaxNew = Math.max.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Age;
                    // }))
                    // ageMinNew = Math.min.apply(Math, updateFiltersData.map(function(d) {
                    //     return d.Age;
                    // }))
                    // yearMaxNew = Math.max.apply(Math, updateFiltersData.map(function(d) {
                    //     d.YearsCompeted.forEach(p => {
                    //         return p;
                    //     });
                    // }))
                    // yearMinNew = Math.min.apply(Math, updateFiltersData.map(function(d) {
                    //     d.YearsCompeted.forEach(p => {
                    //         return p;
                    //     });
                    // }));
                    //
                    // yearSlider.min(yearMinNew).max(yearMaxNew)
                    // ageSlider.min(ageMinNew).max(ageMaxNew)
                    // heightSlider.min(heightMinNew).max(heightMaxNew)
                    // weightSlider.min(weightMinNew).max(weightMaxNew)

                }

                // **************************************************************************************************************
                // Filter Interactivity: Functions to Filter Out Data That Doesn't Meet Selections

                var seasonInitialSelect = 0;
                var genderInitialSelect = 0;
                var sportInitialSelect = 0;
                var lastSelected = "";
                var seasonFilter = d => {
                    return true;
                }
                d3.selectAll("input[name='seasonSP']").on("change", function() {
                    lastSelected = "season";
                    seasonInitialSelect = 1;
                    var selectedSeasonSP = d3.select('input[name="seasonSP"]:checked').property("value");
                    seasonFilter = d => {
                        return (d.Season == selectedSeasonSP)
                    }
                    updateFiltersSP()
                });

                //if gender radio button changes
                var genderFilter = d => {
                    return true;
                }
                d3.selectAll("input[name='genderSP']").on("change", function() {
                    lastSelected = "gender";
                    genderInitialSelect = 1;
                    var selectedGenderSP = d3.select('input[name="genderSP"]:checked').property("value");
                    genderFilter = d => {
                        return (d.Sex == selectedGenderSP)
                    }
                    updateFiltersSP()
                })

                //if sport dropdown changes
                var sportFilter = d => {
                    return true;
                }
                d3.select("#selectSportSP").on("change", function() {
                    lastSelected = "sport";
                    var selectedSportOptionSP = d3.select("#selectSportSP").property("value")
                    if (selectedSportOptionSP != "Select Sport") {
                      sportInitialSelect = 1;
                        sportFilter = d => {
                            return (d.Sport == selectedSportOptionSP)
                        }
                    } else {
                      sportInitialSelect = 0;
                        sportFilter = d => {
                            return true;
                        }
                    }
                    updateFiltersSP()
                })

                //if nationality dropdown changes
                var nationalityFilter = d => {
                    return true;
                }
                d3.select("#selectNationalitySP").on("change", function() {
                  lastSelected = "nationality";
                    var selectedNationalityOptionSP = d3.select("#selectNationalitySP").property("value")
                    if (selectedNationalityOptionSP != "All Nationalities") {
                        nationalityFilter = d => {
                            return (d.NOC == selectedNationalityOptionSP)
                        }
                    } else {
                        nationalityFilter = d => {
                            return true;
                        }
                    }
                })

                //if event dropdown changes
                var eventFilter = d => {
                    return true;
                }
                d3.select("#selectEventSP").on("change", function() {
                  lastSelected = "event";
                    var selectedEventOptionSP = d3.select("#selectEventSP").property("value")
                    if (selectedEventOptionSP != "All Events") {
                        eventFilter = d => {
                            var athleteHasEvent = 0;
                            d.Events.forEach(p => {
                                if (p == selectedEventOptionSP) {
                                    athleteHasEvent += 1;
                                }
                            })
                            return (athleteHasEvent > 0)
                        }
                    } else {
                        eventFilter = d => {
                            return true;
                        }
                    }
                })

                //if year slider changes
                var yearFilter = d => {
                        return true;
                    }
                    (yearSlider).on("onchange", function(value) { //value is [min,max]
                      lastSelected = "year";
                        yearFilter = d => {
                            var withinYearBoolean = 0;
                            for (year in d.YearsCompeted) {
                                if ((d.YearsCompeted[year] >= value[0]) && (d.YearsCompeted[year] <= value[1])) {
                                    withinYearBoolean += 1;
                                }
                            }
                            return (withinYearBoolean > 0)
                        }
                    })

                //if year slider changes
                var ageFilter = d => {
                        return true;
                    }
                    (ageSlider).on("onchange", function(value) { //value is [min,max]
                      lastSelected = "age";
                        ageFilter = d => {
                            return ((d.Age >= value[0]) && (d.Age <= value[1]))
                        }
                    })

                //if height slider changes
                var heightFilter = d => {
                        return true;
                    }
                    (heightSlider).on("onchange", function(value) { //value is [min,max]
                      lastSelected = "height";
                      console.log("hey")
                        heightFilter = d => {
                            return ((d.Height >= value[0]) && (d.Height <= value[1]))
                        }
                    })

                //if year slider changes
                var weightFilter = d => {
                        return true;
                    }
                    (weightSlider).on("onchange", function(value) { //value is [min,max]
                      lastSelected = "weight";
                        weightFilter = d => {
                            return ((d.Weight >= value[0]) && (d.Weight <= value[1]))
                        }
                    })

                function filterData(scatterdata) {
                    newData = [];
                    scatterdata.forEach(d => {
                        if (seasonFilter(d) && genderFilter(d) && sportFilter(d) &&
                            yearFilter(d) && nationalityFilter(d) && eventFilter(d) &&
                            ageFilter(d) && heightFilter(d) && weightFilter(d)) {
                            newData.push(d)
                        }
                    })
                    return newData;
                }

                // **************************************************************************************************************
                //Deletes old points and replaces with new points that fit the criteria of the four filter select options

                // updateFiltersSP()

                function errorhandling_generateSP() {
                    try {
                      console.log("sport = " + sportInitialSelect)
                      console.log("gender = " + genderInitialSelect)
                      console.log("season = " + seasonInitialSelect)
                      if ((sportInitialSelect == 1) && (genderInitialSelect==1) && (seasonInitialSelect==1)){
                        let newData = filterData(medalistProfileData)
                        console.log(newData)
                        generateSP(newData);
                        }
                        else{
                          resetSPGraph()
                          d3.select("#errorTextSP")
                              .style("opacity", 1);
                          }
                    } catch (e) {
                        d3.select("#errorTextSP")
                            .style("opacity", 1);
                    }
                }

                function generateSP(newData) {
                    d3.select("#errorTextSP")
                        .style("opacity", 0);
                    // Circle Plotting
                    let circles = areaSP.selectAll("circle.point").data(newData)
                        .join(enter => enter.append("circle")
                            .attr("class", "point")
                            .attr("opacity", 0.8)
                        )
                        .attr("cx", d => weightScale(d['Weight']))
                        .attr("cy", d => heightScale(d['Height']))
                        .attr("r", d => medalsScale(d['TotalMedals']))
                        .attr("fill", function(d) {
                            return medalsColorScale(d.TopMedal);;
                        });

                    //Update Saved Movies
                    circles.on("click", function(event, d) {
                        updateProfilePanel(d)
                    });
                }


                //Resets all filters
                function resetSP() {
                  //Removing old dropdown options
                  document.getElementById("selectNationalitySP").innerHTML = "";
                  document.getElementById("selectEventSP").innerHTML = "";
                  document.getElementById("selectSportSP").innerHTML = "";
                  document.getElementById("year-slider-range").innerHTML = "";
                  document.getElementById("age-slider-range").innerHTML = "";
                  document.getElementById("height-slider-range").innerHTML = "";
                  document.getElementById("weight-slider-range").innerHTML = "";
                  ageFilter = d => {
                          return true;
                      }
                  heightFilter = d => {
                          return true;
                      }
                  yearFilter = d => {
                          return true;
                      }
                  weightFilter = d => {
                          return true;
                      }
                    initialStateSP() //resets all dropdowns
                    //resets all radio buttons to not checked
                    var seasonRadioList = document.getElementsByName('seasonSP');
                      for (var i = 0; i < seasonRadioList.length; i++) {
                        if(seasonRadioList[i].checked) seasonRadioList[i].checked = false;
                      }
                    var genderRadioList = document.getElementsByName('genderSP');
                      for (var i = 0; i < genderRadioList.length; i++) {
                        if(genderRadioList[i].checked) genderRadioList[i].checked = false;
                      }
                      seasonInitialSelect = 0;
                      genderInitialSelect = 0;
                      sportInitialSelect = 0;
                    //resets all checkboxes to checked
                   d3.select('#medalsOne').property('checked', true);
                   d3.select('#medalsTwo').property('checked', true);
                   d3.select('#medalsThree').property('checked', true);
                  resetSPGraph()
                }

                //Resets all filters
                function resetSPGraph() {
                  console.log("remove circles")
                  areaSP.selectAll("circle.point").remove();
                }

                // **************************************************************************************************************
                // Creating Scales
                const weightScale = d3.scaleLinear().domain([weightMin, weightMax]).range([0, widthSP]);
                const heightScale = d3.scaleLinear().domain([heightMin, heightMax]).range([heightSP, 0]);
                const medalsExtent = d3.extent(medalistProfileData, d => d['TotalMedals']);
                const medalsScale = d3.scaleLinear().domain(medalsExtent).range([3, 50]);

                var goldColor = "#e6c90d";
                var silverColor = "#e0dfd2";
                var bronzeColor = "#c16e00";
                var noMedalsColor = "#7cdaeb";

                const medalsColorScale = d3.scaleOrdinal().domain(
                        ["3", "2", "1"]) //where 1 is bronze, 2 is silver, 3 is gold
                    .range([goldColor, silverColor, bronzeColor]);

                // Y axis
                let leftAxis = d3.axisLeft(heightScale)
                    .tickFormat(d3.format(""));
                let leftGridlines = d3.axisLeft(heightScale)
                    .tickSize(-widthSP)
                    .tickFormat("");

                annotations.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(" + (scattermargin.left) + "," + scattermargin.top + ")")
                    .call(leftAxis)
                annotations.append("g")
                    .attr("class", "y gridlines")
                    .attr("transform", "translate(" + (scattermargin.left) + "," + scattermargin.top + ")")
                    .call(leftGridlines);

                // X axis
                let bottomAxis = d3.axisBottom(weightScale)
                    .tickFormat(d3.format(""));
                let bottomGridlines = d3.axisBottom(weightScale)
                    .tickSize(-heightSP)
                    .tickFormat("");

                annotations.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(" + scattermargin.left + "," + (heightSP + scattermargin.top) + ")")
                    .call(bottomAxis);
                annotations.append("g")
                    .attr("class", "x gridlines")
                    .attr("transform", "translate(" + scattermargin.left + "," + (heightSP + scattermargin.top) + ")")
                    .call(bottomGridlines);

                // Adding Axis Labels

                //Y Axis
                annotations.append("text")
                    .attr("class", "y label")
                    .attr("text-anchor", "middle")
                    .attr("y", 3)
                    .attr("x", (-heightSP / 2))
                    .attr("dy", "0.75em")
                    .attr("transform", "rotate(-90)")
                    .style("font-size", "15px")
                    .style("fill", "white")
                    .text("Height (cm)");

                //X Axis
                annotations.append("text")
                    .attr("class", "x label")
                    .attr("text-anchor", "middle")
                    .attr("x", (widthSP / 2) + scattermargin.left)
                    .attr("y", heightSP + scattermargin.bottom)
                    .style("font-size", "15px")
                    .style("fill", "white")
                    .text("Weight (kg)");

                // Creating the Legend
                scatterLeg.append("g")
                    .attr("class", "legend-title")
                    .append("text")
                    .text("Highest Medal")
                    .attr("x", 125)
                    .attr("y", 30)
                    .style("font-weight", "bold")
                    .style("fill", "white")
                    .style("font-size", "15px")
                    .style("text-anchor", "start");

                var legendSP = scatterLeg.selectAll()
                    .data([3, 2, 1])
                    .enter().append("g")
                    .attr("class", "legendSP")
                    .attr("transform", function(d, i) {
                        return "translate(" + i * 100 + ",10)";
                    });

                // Draw Colored Circles in the Legend
                legendSP.append("circle")
                    .attr("cx", 50)
                    .attr("cy", 50)
                    .attr("r", 8)
                    .style("fill", function(d) {
                        return medalsColorScale(d)
                    })
                    .attr("transform", function(d, i) {
                        return "translate(-5,0)";
                    });

                // Add Corresponding Text in the Legend
                legendSP.append("text")
                    .attr("x", 60)
                    .attr("y", 50)
                    .attr("dy", ".35em")
                    .style("text-anchor", "start")
                    .style("font-size", "13px")
                    .style("fill", "white")
                    .text(function(d) {
                        if (d == 3) {
                            return "Gold";
                        } else if (d == 2) {
                            return "Silver";
                        } else {
                            return "Bronze";
                        }
                    });

                scatterLeg.append("g")
                    .attr("class", "legend-title2")
                    .append("text")
                    .text("Total Medals")
                    .attr("x", 525)
                    .attr("y", 30)
                    .style("font-weight", "bold")
                    .style("fill", "white")
                    .style("font-size", "15px")
                    .style("text-anchor", "start");

                var legendSP2 = scatterLeg.selectAll()
                    .data([5, 10, 15, 20]) //3 is 1 medal, 12 is 5 medals, 20 is 10 medals, 47 is 25 medals - didn't work? how is radius scale working?
                    .enter().append("g")
                    .attr("class", "legendSP2")
                    .attr("transform", function(d, i) {
                        return "translate(" + i * 100 + ",10)";
                    });

                // Draw Colored Circles in the Legend
                legendSP2.append("circle")
                    .attr("cx", 400)
                    .attr("cy", 50)
                    .attr("r", function(d) {
                        return medalsScale(d) * .5
                    })
                    .style("fill", "lightgray")
                    .attr("transform", function(d, i) {
                        return "translate(-5,0)";
                    });

                // Add Corresponding Text in the Legend
                legendSP2.append("text")
                    .attr("x", 420)
                    .attr("y", 50)
                    .attr("dy", ".35em")
                    .style("text-anchor", "start")
                    .style("font-size", "13px")
                    .style("fill", "white")
                    .text(function(d) {
                        if (d == 5) {
                            return "1-2";
                        } else if (d == 10) {
                            return "3-4";
                        } else if (d == 15) {
                            return "5-10";
                        } else if (d == 20) {
                            return "10-30";
                        }
                    });

                function updateProfilePanel(d) {
                  d.EventMedals.forEach(p => {
                    console.log(p)
                    console.log(p.Event)
                    // if (p.EventMedals.match(/Mixed/) != null) {
                    //     d["Event"] = "Mixed " + d.Event.split('Mixed ').pop().trim();
                    // } else if (d.Event.match(/men's/) != null) {
                    //     d["Event"] = d.Event.split("men's ").pop().trim();
                    // } else {
                    //     d["Event"] = d.Event.split("Men's ").pop().trim();
                    // }
                  })
                    d3.select("#profilePanelSPIntro")
                        .html("<h4><b>" + d.NOC + "</b></h4>" +
                            "<h4><b>" + d.Name + "</b></h4>");

                    d3.select("#profilePanelSPIntroStats")
                        .html("<p><b>Stats:</b></p>" +
                            "<p>" + d.YearsCompeted.length + " Olympics</p>" +
                            "<p>" + d.TotalMedals + " Medals</p>" +
                            "<p>" + parseFloat((d.TotalMedals / d.TotalOlympicEvents) * 100).toFixed(0) + "% Success Rate</p>");

                    // d3.select("#profilePanelSPTraitsIcon").selectAll("svg:image").remove()
                    var profilePanelSPGenderIcon = d3.select("#profilePanelSPTraitsIcon").append("svg")
                        .attr("class", "profilePanelSPGenderIcon")
                        .attr("width", 100)
                        .attr("height", 100);

                    var iconSP = profilePanelSPGenderIcon.append("g");

                    if (d.Sex == "F") {
                        var img = iconSP.append("svg:image")
                            .attr("xlink:href", "Images/female.svg")
                            .attr("width", 100)
                            .attr("height", 100)
                            .style("fill", "white")
                            .attr("x", 10)
                            .attr("y", 10);
                    } else {
                        var img = iconSP.append("svg:image")
                            .attr("xlink:href", "Images/male.svg")
                            .attr("width", 100)
                            .attr("height", 100)
                            .style("stroke", "white")
                            .attr("x", 10)
                            .attr("y", 10);
                    }

                    d3.select("#profilePanelSPTraitsText")
                        .html("<h4><b>" + d.Age + " years old</b></h4>" +
                            "<p>" + d.Height.toFixed(0) + "m | " + d.Weight.toFixed(0) + "kg</p>");

                    //Bar graph

                    var stackdata = ["Gold", "Silver", "Bronze", "NoMedals"].map(function(medals) {
                        return d.EventMedals.map(function(k, i) { //x: "Event", y0: 0, y: how many medals
                            return {
                                x: k["Event"],
                                y: +k[medals]
                            };
                        })
                    });

                    for (i = 0; i < stackdata.length; i++) {
                        if (i == 0) {
                            for (j = 0; j < stackdata[i].length; j++) {
                                stackdata[i][j]["y0"] = 0;
                            }
                        } else {
                            for (j = 0; j < stackdata[i].length; j++) {
                                stackdata[i][j]["y0"] = (stackdata[i - 1][j]["y"] + stackdata[i - 1][j]["y0"]);
                            }
                        }
                    }
                    const barGraphSP = d3.select("svg#profilePanelSPSVG")
                    const barWidthSP = barGraphSP.attr("width");
                    const barHeightSP = barGraphSP.attr("height");
                    var barMarginSP = {
                        top: 10,
                        right: 10,
                        bottom: 50,
                        left: 50
                    };
                    const barMarginWidth = barWidthSP - barMarginSP.left - barMarginSP.right;
                    const barMarginHeight = barHeightSP - barMarginSP.top - barMarginSP.bottom;

                    var barGraphSPBars = barGraphSP.append("svg")
                        .attr("width", barMarginWidth + barMarginSP.left + barMarginSP.right)
                        .attr("height", barMarginHeight + barMarginSP.top + barMarginSP.bottom)
                        .append("g")
                        .attr("transform",
                            "translate(" + barMarginSP.left + "," + barMarginSP.top + ")");

                    var x = d3.scaleBand()
                        .rangeRound([0, barMarginWidth])
                        .padding(0.1);

                    var y = d3.scaleLinear()
                        .rangeRound([barMarginHeight, 0]);

                    var color = [goldColor, silverColor, bronzeColor, noMedalsColor]

                    var xAxis = d3.axisBottom()
                        .scale(x);

                    x.domain(stackdata[0].map(function(d) {
                        return d.x;
                    }));

                    y.domain([0,
                            d3.max(stackdata[stackdata.length - 1],
                                function(d) {
                                    return d.y0 + d.y;
                                })
                        ])
                        .nice();

                    var layer = barGraphSPBars.selectAll()
                        .data(stackdata)
                        .enter().append("g")
                        .attr("class", "stack")
                        .style("fill", function(d, i) {
                            return color[i]
                        });

                    layer.selectAll("rect")
                        .data(function(d) {
                            return d;
                        })
                        .enter().append("rect")
                        .attr("x", function(d) {
                            return x(d.x);
                        })
                        .attr("y", function(d) {
                            return y(d.y + d.y0);
                        })
                        .attr("height", function(d) {
                            return y(d.y0) - y(d.y + d.y0);
                        })
                        .attr("width", 20)
                        .style("stroke", "lightgray");

                    barGraphSPBars.append("g")
                        .attr("class", "axis")
                        .attr("transform", "translate(0," + barMarginHeight + ")")
                        .call(xAxis);
                }
            }
            requestData();
        </script>
    </div>
</body>

</html>
